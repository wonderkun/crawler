> åŸæ–‡é“¾æ¥: https://www.anquanke.com//post/id/214897 


# åˆ©ç”¨ ZoomEye è¿½è¸ªå¤šç§ Redteam C&amp;C åæ¸—é€æ”»å‡»æ¡†æ¶


                                é˜…è¯»é‡ Â Â 
                                **237507**
                            
                        |
                        
                                                            è¯„è®º
                                <b>
                                    <a target="_blank">1</a>
                                </b>
                                                                                    



[![](https://p3.ssl.qhimg.com/t015477a402173b93e8.jpg)](https://p3.ssl.qhimg.com/t015477a402173b93e8.jpg)



## å‰è¨€

ç”±äºå·¥ä½œåŸå› ä¸€ç›´éƒ½æ˜¯ç½‘ç»œç©ºé—´æœç´¢å¼•æ“é‡åº¦ç”¨æˆ·ï¼ŒåŒ…æ‹¬Shodan/ZoomEye/Censys/Fofaç­‰å¹³å°éƒ½æœ‰è¿‡ä½¿ç”¨ç»éªŒï¼Œç”šè‡³è‡ªå·±å›¢é˜Ÿä¹Ÿå°è¯•å¼€å‘è¿‡ç±»ä¼¼å¹³å°ã€‚è‡ªè®¤ä¸ºè¿˜æ˜¯éå¸¸äº†è§£çš„ï¼Œåœ¨å‰é¢çœ‹è¿‡é»‘å“¥å†™çš„å‡ ç¯‡æ–‡ç« ååŠå›½å¤–ç ”ç©¶è€…çš„ä¸€äº›æ–‡ç« ååšäº†ä¸€äº›å°è¯•ï¼Œé¡ºå¸¦ä¹Ÿåˆ†äº«ä¸‹å¤šå¹´ä½¿ç”¨æœç´¢å¼•æ“çš„ä¸€äº›æœç´¢å¥—è·¯ï¼Œå¸Œæœ›å¤§å®¶èƒ½å–œæ¬¢ï¼Œå½“ç„¶è¿™ä¸ªä¹Ÿæ˜¯ä¸ºäº†è¿åˆä¸‹ZoomEyeå®˜æ–¹å†™æ–‡ç« é€ä¼šå‘˜çš„æ´»åŠ¨ ğŸ™‚

ä¸è¯´åºŸè¯äº†ï¼Œæ­¥å…¥æ­£é¢˜ï¼š



## 1ã€Cobalt Strike

è¿™ä¸ªæ–¹æ³•æœ€æ—©æ˜¯åœ¨é»‘å“¥åœ¨mediumä¸Šå‘å¸ƒä¸¤ç¯‡æ–‡ç« ä»‹ç»åˆ©ç”¨ZoomEyeè¯†åˆ«åœ¨é‡Cobalt StrikeæœåŠ¡å™¨çš„æ–‡ç« [1][2]ä»‹ç»çš„,å› ä¸ºæ–‡ç« æ˜¯è‹±æ–‡å†™çš„å‘å¸ƒåœ¨mediumä¸Šå›½å†…ç›´æ¥è®¿é—®ä¸åˆ°ï¼Œæ‰€ä»¥è¿™é‡Œå†æ¬¡ç®€å•ä»‹ç»ä¸€ä¸‹ã€‚åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬éœ€è¦æä¸€ä¸‹Fox-itçš„å·¥ä½œï¼Œæ˜¯ä»–ä»¬æœ€æ—©å¼€å§‹é€šè¿‡ç½‘ç»œç©ºé—´æµ‹ç»˜æŠ€æœ¯å»è¯†åˆ«è¿½è¸ªåœ¨é‡Cobalt Strikeçš„å·¥ä½œå¹¶åœ¨ä»–ä»¬çš„blogä¸Šå‘å¸ƒäº†å¯¹åº”çš„ç ”ç©¶æˆæœ[3]ï¼ŒCobalt Strikeæä¾›çš„WebæœåŠ¡æ˜¯åŸºäºNanoHTTPDå¼€æºæ¡†æ¶å¼€å‘çš„ï¼Œè€Œå½“æ—¶Fox-itå·¥ç¨‹å¸ˆå‘ç°NanoHTTPDè¿”å›banneré‡Œå­˜åœ¨ä¸€ä¸ªå¼‚å¸¸çš„ç©ºæ ¼â€œbugâ€ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå¼‚å¸¸çš„ç©ºæ ¼å»è¯†åˆ«ã€‚éšåCobalt Strikeå®˜æ–¹åœ¨å‘å¸ƒçš„3.13ç‰ˆæœ¬äº†å¯¹è¿™ä¸ªâ€œbugâ€åšäº†æ›´æ–°å¤„ç†ã€‚

äº‹å®ä¸Šæˆ‘ä»¬ä¸éœ€è¦è¿™ä¸ªåˆ©ç”¨è¿™ä¸ªæ‰€è°“çš„å¼‚å¸¸çš„ç©ºæ ¼â€œbugâ€ï¼Œæ ¹æ®è§‚å¯ŸCobalt Strikeçš„WEBæœåŠ¡è¿”å›httpå¤´å­˜åœ¨æ¯”è¾ƒæ˜æ˜¾çš„ç‰¹å¾ï¼Œç”±æ­¤æ¥è¯†åˆ«è¿½è¸ªCobalt Strikeã€‚

é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹Cobalt Strikeç‰ˆæœ¬&lt;3.13çš„ï¼Œè¿”å›bannerä¿¡æ¯ï¼ˆç›´æ¥å¤åˆ¶çš„é»‘å“¥æ–‡ç« é‡Œçš„å†…å®¹ï¼‰

```
âœ curl http://x.x.x.x:8081/ -v

- Rebuilt URL to: [http://x.x.x.x:8081/](http://x.x.x.x:8081/)
- Trying x.x.x.xâ€¦
- TCP_NODELAY set
- Connected to x.x.x.x (x.x.x.x) port 8081 (#0)

&gt; GET / HTTP/1.1
Host: x.x.x.x:8081
User-Agent: curl/7.54.0
Accept: /

&lt; HTTP/1.1 404 Not Found
&lt; Content-Type: text/plain
&lt; Date: Wed, 27 Feb 2019 14:43:19 GMT
&lt; Content-Length: 0
&lt;

```

é€šè¿‡curlç›´æ¥è¯·æ±‚Cobalt Strikeçš„WEBæœåŠ¡å™¨ç«¯å£ä¸»é¡µå†…å®¹è¿”å›httpå¤´éå¸¸ç®€å•å¹¶ä¸”ç‰¹å¾åŒ–ï¼Œç›´æ¥æå–ä¸¤ä¸ªå…³é”®å­—ç¬¦ä¸²`"HTTP/1.1 404 Not Found Content-Type: text/plain Date:"`åŠ`"Content-Length: 0"` (æ³¨ï¼šè¿™é‡Œéœ€è¦è¯´æ˜ä¸‹ZoomEyeåœ¨åŒ¹é…å¤„ç†æ˜¯å¿½è§†å›è½¦æ¢è¡Œçš„ï¼Œä¸æå–Dateçš„éƒ¨åˆ†æ˜¯å› ä¸ºè¿™ä¸ªè¿™ä¸ªæ—¶é—´æ˜¯å˜åŒ–çš„)ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡+è¿›è¡Œâ€œä¸”â€è¿ç®—ï¼ˆæ³¨ï¼šè¿™é‡Œé¡ºå¸¦è¯´æ˜ä¸‹ZoomEyeæ”¯æŒçš„é€»è¾‘è¿ç®—ï¼šç©ºæ ¼ ä¸ºorè¿ç®—ç¬¦ è¡¨ç¤ºé€»è¾‘â€œæˆ–â€è¿ç®—ï¼Œ+ ä¸ºandè¿ç®—ç¬¦ è¡¨ç¤ºé€»è¾‘â€œä¸”â€è¿ç®—ï¼Œ- ä¸º notè¿ç®—ç¬¦ è¡¨ç¤ºé€»è¾‘â€œéâ€è¿ç®—ï¼‰

æœç´¢è¯­æ³•å¦‚ä¸‹ï¼š

`"HTTP/1.1 404 Not Found Content-Type: text/plain Date:" +"Content-Length: 0"`

[https://www.zoomeye.org/searchResult?q=â€HTTP/1.1404NotFoundContent-Type:text/plainDate:â€+â€Content-Length:0â€&amp;t=all](https://www.zoomeye.org/searchResult?q=%22HTTP%2F1.1)

é€šè¿‡é‡‡æ ·è§‚å¯Ÿï¼Œè¿™ä¸ªæœç´¢è¯­æ³•å¾—åˆ°çš„ç»“æœæœ‰ä¸å°‘è¯¯æŠ¥ï¼šæ¯”å¦‚Cobalt Strikeçš„è¿”å›å¤´ä¿¡æ¯é‡Œæ˜¯æ²¡æœ‰â€Server:â€å¤´çš„ï¼Œä¹Ÿæ²¡æœ‰â€Connection:â€ç­‰å¤´ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡-è¿ç®—(notè¿ç®—)è¿›è¡Œæ’é™¤,é€šè¿‡å°è¯•æˆ‘ä»¬å‘ç°â€Serverâ€è¿™ä¸ªå…³é”®è¯åœ¨äºsslç­‰ä¿¡æ¯é‡Œç›´æ¥è¿ç®—å¯èƒ½å¯¼è‡´æ¼æŠ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç›´æ¥ä½¿ç”¨â€Connection:â€çš„notè¿ç®—ï¼Œæœ€ç»ˆæœç´¢è¯­æ³•å¦‚ä¸‹ï¼š

`"HTTP/1.1 404 Not Found Content-Type: text/plain Date:" +"Content-Length: 0" -"Connection:"`

[https://www.zoomeye.org/searchResult?q=â€HTTP%2F1.1 404 Not Found Content-Type%3A text%2Fplain Date%3Aâ€ %2Bâ€Content-Length%3A 0â€ -â€œConnection%3Aâ€](https://www.zoomeye.org/searchResult?q=%22HTTP%2F1.1%20404%20Not%20Found%20%20%20Content-Type%3A%20text%2Fplain%20Date%3A%22%20%2B%22Content-Length%3A%200%22%20-%22Connection%3A%22)

[![](https://p0.ssl.qhimg.com/t0104bfb5cd54f49486.png)](https://p0.ssl.qhimg.com/t0104bfb5cd54f49486.png)

ä¸Šé¢æˆ‘ä»¬æåˆ°Cobalt Strikeåœ¨3.13ç‰ˆæœ¬çš„æ—¶å€™ä¿®å¤äº†â€œå¼‚å¸¸ç©ºæ ¼bugâ€çš„åŒæ—¶ä¹Ÿä¿®æ”¹äº†é»˜è®¤è¿”å›çš„httpå¤´ï¼šï¼ˆç›´æ¥å¤åˆ¶çš„é»‘å“¥æ–‡ç« é‡Œçš„å†…å®¹ï¼‰

```
âœ curl http://x.x.x.x:8001/ -v

- Rebuilt URL to: http://x.x.x.x:8001/
- Trying x.x.x.xâ€¦
- TCP_NODELAY set
- Connected to x.x.x.x port 8001 (#0)

&gt; GET / HTTP/1.1
Host: x.x.x.x:8001
User-Agent: curl/7.54.0
Accept: /

&lt; HTTP/1.1 404 Not Found
&lt; Date: Thu, 26 Mar 2020 13:19:16 GMT
&lt; Content-Type: text/plain
&lt; Content-Length: 0
&lt;
```

å¯ä»¥çœ‹åˆ°è¿”å›çš„httpæœ‰å†…å®¹é¡ºåºè¿›è¡Œå˜åŠ¨ï¼šDate:å¤´æå‰äº†ï¼Œæ‰€ä»¥ä¹‹å‰çš„æœç´¢è¯­æ³•æ˜¯æ²¡åŠæ³•ç›´æ¥å·¥ä½œäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŒ‰ä¸Šé¢æåˆ°å¥—è·¯ç¨å¾®æ”¹å˜ä¸‹è¯•ä¸€ä¸‹ï¼Œå› ä¸ºZoomEyeåŒ¹é…æ¨¡å¼ä¸å›å»è€ƒè™‘å›è½¦æ¢è¡Œçš„é—®é¢˜ï¼Œæˆ‘ä»¬æŠŠbanneræ•´ç†ä¸ºä¸€è¡Œï¼š

`HTTP/1.1 404 Not Found Date: Fri, 10 Apr 2020 07:16:27 GMT Content-Type: text/plain Content-Length: 0`

å› ä¸ºæ—¶é—´æ˜¯å˜åŒ–çš„æ‰€ä»¥åˆ†å‰²ä¸€ä¸‹ï¼š

```
HTTP/1.1 404 Not Found Date:
Fri, 10 Apr 2020 07:16:27
GMT Content-Type: text/plain Content-Length: 0
```

æˆ‘ä»¬ç›´æ¥å–1 +3æœç´¢ï¼Œå¹¶ç»§ç»­ä½¿ç”¨ -â€œConnection:â€ç»§ç»­æ’é™¤ï¼Œå¾—åˆ°æœ€ç»ˆæœç´¢è¯­æ³•ï¼š

`"HTTP/1.1 404 Not Found Date:" +"GMT Content-Type: text/plain Content-Length: 0" -"Connection:"`

[https://www.zoomeye.org/searchResult?q=â€HTTP%2F1.1 404 Not Found Date%3Aâ€ %2Bâ€GMT Content-Type%3A text%2Fplain Content-Length%3A 0â€ -â€œConnection%3Aâ€](https://www.zoomeye.org/searchResult?q=%22HTTP%2F1.1%20404%20Not%20Found%20Date%3A%22%20%2B%22GMT%20Content-Type%3A%20text%2Fplain%20Content-Length%3A%200%22%20-%22Connection%3A%22)

[![](https://p0.ssl.qhimg.com/t017bed0404cda30746.png)](https://p0.ssl.qhimg.com/t017bed0404cda30746.png)

å¤§å®¶å¦‚æœæœ‰å…´è¶£å¯ä»¥å»æ¨ç‰¹ç­‰ä¸Šæ‰¾ä¸€äº›å¼€æºæƒ…æŠ¥ä¿¡æ¯éªŒè¯ä¸€ä¸‹ã€‚

è¿™é‡Œéœ€è¦è¯´æ˜ä¸‹è¿™ä¸ªä¸»è¦æ˜¯æ ¹æ®NanoHTTPDçš„è¿”å›å¤´è¿›è¡Œè¯†åˆ«çš„å°¤å…¶æ˜¯é’ˆå¯¹Cobalt Strike 3.13ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥æœ‰å¯èƒ½å…¶ä»–çš„è®¾å¤‡ä¹Ÿä½¿ç”¨NanoHTTPDè¿™ä¸ªç»„ä»¶ä¹Ÿå›è¢«è¯†åˆ«å‡ºæ¥å½¢æˆè¯¯æŠ¥ï¼Œå¦å¤–åœ¨é»‘å“¥å‘å¸ƒæ–¹æ³•åæœ‰å¾ˆå¤šçš„Cobalt Strikeä½¿ç”¨å›¢é˜Ÿå¼€å§‹ä¿®æ”¹äº†é…ç½®è¿›è¡Œä¼ªè£…ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æˆ‘è¿™é‡Œéœ€è¦æé†’çº¢é˜Ÿæ³¨æ„åœ¨ä½¿ç”¨Cobalt Strikeçš„æ—¶å€™åªæ˜¯ä¿®æ”¹äº†è¯ä¹¦å•¥çš„é…ç½®ï¼Œé‚£æ˜¯åŸè¿œè¿œä¸å¤Ÿçš„ã€‚



## 2ã€Meterpreter

Metasploit çš„ Meterpreter å…¶å®å¸¸ç”¨çš„æ–¹å¼æœ‰tcpä¹Ÿæœ‰http(s)çš„æ¨¡å¼ï¼Œåœ¨ZoomEyeä¸Šæœ‰ç°æˆMetasploitç›¸å…³çš„è§„åˆ™ï¼ˆæç¤ºï¼šåœ¨æœç´¢æ¡†é‡Œè¾“å…¥MetasploitåŠå¯å…³è”å‡ºæ‰€æœ‰çš„Metasploitç›¸å…³çš„appï¼‰ï¼š

`app:"Metasploit Rex httpd"`<br>`app:"Metasploit meterpreter metsvc"`<br>`app:"Metasploit meterpreter"`<br>`app:"Metasploit browser_autopwn"`

è¿™å‡ ä¸ªè§„åˆ™å¤§å¤šæ˜¯åŸºäºtcpçš„æ–¹å¼çš„ï¼Œå¹¶ä¸æ˜¯è¿™æ¬¡ä¸»è¦ç›®æ ‡ã€‚ä¹Ÿå°±æ˜¯http(s)çš„æ–¹å¼æ˜¯æˆ‘ä»¬ä»Šå¤©çš„ç›®æ ‡ï¼Œåœ¨2019å¹´çš„ä¸€ç¯‡æ–‡ç« é‡Œæœ‰å›½å¤–çš„ç ”ç©¶å‘˜æåˆ°äº†ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰ç‚¹ç±»ä¼¼Cobalt Strikeä¸Šé¢çš„æ–¹æ³•[4]ï¼Œéƒ½æ˜¯ä»http(s)æœåŠ¡è¿”å›ç‰¹å¾å…¥æ‰‹ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹ä¸€ä¸‹`msf`çš„ç›¸å…³ä»£ç  `lib/msf/core/handler/reverse_http.rb#L82 [5]`

```
OptString.new('HttpUnknownRequestResponse',
      'The returned HTML response body when the handler receives a request that is not from a payload',
      default: '&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;'
    ),
```

è¿”å›ç‰¹å¾ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œäºæ˜¯å°è¯•æœç´¢ï¼š`"&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"`

[https://www.zoomeye.org/searchResult?q=â€&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;â€œ](https://www.zoomeye.org/searchResult?q=%22%3Chtml%3E%3Cbody%3E%3Ch1%3EIt%20works!%3C/h1%3E%3C/body%3E%3C/html%3E%22)

å¾ˆæ˜æ˜¾è¿™ä¸ªç»“æœè¯¯æŠ¥å¤ªå¤šï¼Œæˆ‘çŒœMSFå¼€å‘äººå‘˜å½“æ—¶å°±æ˜¯æƒ³æ¨¡ä»¿Apacheçš„é»˜è®¤è¿”å›å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—å›åˆ°Cobalt Strikeå¥—è·¯ä¸Šï¼Œçœ‹çœ‹Metasploit Meterpreter http(s)ä¸Šçº¿æ¨¡å¼WEBæœåŠ¡çš„è¿”å›å¤´çš„ä¿¡æ¯ï¼š

```
- Trying 0.0.0.0:1337...
- TCP_NODELAY set
- Connected to 0.0.0.0 port 1337 (#0)

&gt; GET / HTTP/1.1
Host: 0.0.0.0:1337
User-Agent: curl/7.68.0
Accept: /

- Mark bundle as not supporting multiuse
&lt; HTTP/1.1 200 OK
HTTP/1.1 200 OK
&lt; Connection: close
Connection: close
&lt; Server: Apache
Server: Apache
&lt; Content-Length: 44
Content-Length: 44

&lt;

- Closing connection 0
&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;

```

åœ¨ä¸Šé¢æåˆ°çš„å›½å¤–ç ”ç©¶å‘˜é‚£ç¯‡æ–‡ç« [5]é‡Œæäº†ä¸€ä¸ªç‰¹å¾ï¼šçœŸæ­£çš„Apacheçš„é»˜è®¤è¿”å›é¡µé¢çš„å†…å®¹æœ‰ä¸€ä¸ªé¢å¤–çš„\nï¼Œè€ŒMSFçš„æ²¡æœ‰ï¼Œäºæ˜¯é€šè¿‡Censysæä¾›çš„body hashè§„åˆ™è¿›è¡ŒåŒ¹é…æœç´¢[6],éšæœºè¿½è¸ªäº†å‡ ä¸ªç›®æ ‡å¾ˆæ˜¾ç„¶è¿™ä¸ªæ–¹æ³•å­˜åœ¨å¾ˆä¸¥é‡çš„è¯¯æŠ¥ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåªèƒ½å›å½’åˆ°ZoomEyeçš„è€å¥—è·¯ä¸Šäº†ï¼Œè§‚å¯ŸMetasploit Meterpreter http(s)æ¨¡å¼çš„WEBæœåŠ¡è¿”å›bannerï¼š

```
HTTP/1.1 200 OK
Connection: close
Server: Apache
Content-Length: 44

&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;

```

å› ä¸ºè¿™äº›æ²¡æœ‰å­˜åœ¨å˜åŒ–çš„å…ƒç´ ï¼Œé‚£å°±ç›´æ¥å¤åˆ¶ä¸Šé¢çš„å­—ç¬¦æ®µå¼€æœï¼š

`"HTTP/1.1 200 OK Connection: close Server: Apache Content-Length: 44 &lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"`

å½“ç„¶å› ä¸ºè¿™ä¸ªContent-Length: 44 å·²ç»å¾ˆå”¯ä¸€äº†ï¼Œæ‰€ä»¥å…¶å®æˆ‘ä»¬åœ¨ç®€æ´ä¸€ä¸‹å»æ‰åé¢çš„htmlå†…å®¹ï¼Œæœ€ç»ˆæœç´¢è¯­æ³•å¦‚ä¸‹ï¼š

`"HTTP/1.1 200 OK Connection: close Server: Apache Content-Length: 44"`

[https://www.zoomeye.org/searchResult?q=â€HTTP%2F1.1 200 OK Connection%3A close Server%3A Apache Content-Length%3A 44â€](https://www.zoomeye.org/searchResult?q=%22HTTP%2F1.1%20200%20OK%20Connection%3A%20close%20Server%3A%20Apache%20Content-Length%3A%2044%22)

[![](https://p4.ssl.qhimg.com/t01c51d0da28bfd5ed5.png)](https://p4.ssl.qhimg.com/t01c51d0da28bfd5ed5.png)



## 3ã€Empire

ç›¸æ¯”Cobalt StrikeåŠMetasploitï¼Œå¯èƒ½EmpireçŸ¥ååº¦ç¨å¾®å·®é‚£ä¹ˆä¸€ç‚¹ç‚¹ï¼Œä¸è¿‡ç›®å‰ä¹Ÿæ˜¯æœ‰ä¸å°‘äººåœ¨ä½¿ç”¨ï¼Œåœ¨è¿™é‡Œæˆ‘éœ€è¦è¯´æ˜ä¸€ä¸‹æˆ‘ä¹‹å‰æ˜¯æ²¡æœ‰ç”¨è¿‡è¿™ä¸ªä¸œè¥¿çš„æ‰€ä»¥å°±ä¸å¤šåšå…¶ä»–è¯„ä»·äº†ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯ä»‹ç»æ€ä¹ˆé€šè¿‡ZoomEyeå»æœç´¢è¿™äº›æ¡†æ¶ï¼Œæˆ‘è¿™é‡Œä¸æƒ³ç°æˆå•ç‹¬å»å®‰è£…ä¸€ä¸ªå»è·å–æŒ‡çº¹ï¼Œé‚£è¿˜æœ‰å…¶ä»–å¥—è·¯å¯ä»¥èµ°ï¼Ÿ

è¿™é‡Œæˆ‘ä»‹ç»ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„å¥—è·¯ï¼šâ€œä»å…¶ä»–æœç´¢å¼•æ“è¯­æ³•åˆ°ZoomEyeæœç´¢è¯­æ³•â€ã€‚å†æ­¤ä¹‹å‰æˆ‘ç•™æ„åˆ°ä¸€ä¸ªè‘—åFireEyeå…¬å¸çš„ç ”ç©¶è€…çš„çš„ä¸€ä¸ªPPT[7]ï¼ˆè¿™é‡Œéœ€è¦è¯´æ˜ä¸‹çš„æ˜¯è¿™ä¸ªPPTçš„ä¸»é¢˜å’Œæœ¬æ–‡å…¶å®ä¸€æ ·çš„ï¼Œæœ¬æ–‡çš„ä¸‹é¢çš„ä¸€äº›ç ”ç©¶çš„åŒ…æ‹¬Empireç­‰æ¡†æ¶ç›®æ ‡ä¹Ÿæ˜¯å‚è€ƒäº†è¿™ä¸ªPPTï¼‰å¦å¤–é¡ºå¸¦è¯´ä¸€ä¸‹ä½“å¤–å…«å¦ï¼š

è¿™ä¸ªPPTé‡Œçš„ä¸»é¢˜å’Œæœ¬æ–‡å…¶å®æ˜¯ä¸€ä¸ªä¸»é¢˜ï¼Œä¹‹å‰é»‘å“¥ä¹Ÿåœ¨ä»–çš„çŸ¥è¯†æ˜Ÿçƒâ€œé»‘ç§‘æŠ€â€é‡Œåæ§½è¿‡ï¼Œå¤§æ„æ˜¯è¯´ä»–è¿™ä¸ªPPTé‡Œä½¿ç”¨çš„å¥—è·¯å°¤å…¶æ˜¯Cobalt Strikeé‚£éƒ¨åˆ†æ˜¯æœ‰å‚è€ƒäº†æœ¬æ–‡å¼€å§‹æåˆ°é»‘å“¥çš„é‚£äº›ç ”ç©¶å†…å®¹çš„ï¼Œè€Œä¸”å…¨ç¯‡ç›´æ¥å¿½è§†äº†æ¥è‡ªä¸­å›½çš„ZoomEyeï¼Œçœ‹æ¥å·æ™®åŒå­¦è¦†ç›–é¢è¿˜æ˜¯å¾ˆå¹¿çš„ï¼

å›å½’æ­£é¢˜ï¼Œåœ¨è¿™ä¸ªppté‡Œæåˆ°äº†ä¸€ä¸ªEmpireçš„shodanæœç´¢è¯­æ³•ï¼š

http.html_hash:â€611100469â€<br>[https://www.shodan.io/search?query=http.html_hash%3Aâ€611100469â€](https://www.shodan.io/search?query=http.html_hash%3A%22611100469%22)

è¿™é‡Œåˆ©ç”¨çš„èƒŒåçš„åŸç†ä¹Ÿç±»ä¼¼ä¸Šé¢Metasploit Meterpreteræåˆ°çš„é—®é¢˜ï¼Œè¿™é‡ŒEmpireæ˜¯æƒ³ä¼ªè£…æˆä¸ºIISæœåŠ¡å™¨ï¼Œä½†æ˜¯å› ä¸ºä½¿ç”¨ç©ºæ ¼ã€tabçš„åŒºåˆ«å¯¼è‡´è·ŸçœŸæ­£çš„IISé¡µé¢ä¸ä¸€è‡´å¯¼è‡´çš„ï¼Œæ‰€ä»¥å›½å¤–çš„ç ”ç©¶äººå‘˜éƒ½å–œæ¬¢ä»æ¯”å¯¹è¿™ä¸ªè§’åº¦å»æƒ³åŠæ³•ã€‚é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆä»Shodanè¿™ä¸ªè¯­æ³•è½¬åŒ–ä¸ºZoomEyeçš„æœç´¢è¯­æ³•å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬é€šè¿‡Shodanæœç´¢ç»“æœæ‰¾åˆ°å¦‚ä¸‹bannerï¼š

```
HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 682
Cache-Control: no-cache, no-store, must-revalidate
Pragma: no-cache
Expires: 0
Server: Microsoft-IIS/7.5
Date: Wed, 19 Aug 2020 08:33:52 GMT
```

ç»†å¿ƒçš„äººå¯ä»¥å›å‘ç°ï¼šçœŸå‡IISé¡µé¢çš„ä¸»è¦åŒºåˆ«åœ¨htmlé‡Œç©ºæ ¼ä¸tabçš„åŒºåˆ«ï¼Œé‚£ä¸ºä»€ä¹ˆä½ åªå…³æ³¨httpå¤´å‘¢ï¼Ÿå…¶å®è¿™ä¸ªé—®é¢˜ä¸Šé¢çš„ä¾‹å­å°±ç”¨è¿‡äº†é‚£å°±æ˜¯ â€œContent-Length: 682 â€œï¼Œé¡µé¢å†…å®¹é•¿åº¦å˜åŒ–éƒ½ä½“ç°åœ¨httpå¤´Content-Lengthä¸Šï¼Œå¯¹äºæ­£å¸¸çš„IIS7çš„è¿”å›Content-Length æˆ‘ä»¬å¯ä»¥é€šè¿‡ZoomEyeæœç´¢:

<code>&lt;title&gt;IIS7&lt;/title&gt;<br>
[https://www.zoomeye.org/searchResult?q=&lt;title&gt;IIS7&lt;/title&gt;](https://www.zoomeye.org/searchResult?q=%3Ctitle%3EIIS7%3C/title%3E)</code>

æ­£å¸¸çš„ä¸º`"Content-Length: 689"`, è€Œä¸”Empireçš„è¿”å›å¤´çš„å†…å®¹åŠé¡ºåºæ˜¯ç›¸å¯¹å›ºå®šçš„ï¼ŒIIS7æœ¬èº«å¾ˆå¤šè®¾ç½®ç›¸å…³è€Œæœ‰å˜åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­è€å¥—è·¯æå–httpå¤´ç‰¹å¾ï¼š

`"HTTP/1.0 200 OK Content-Type: text/html; charset=utf-8 Content-Length: 682 Cache-Control: no-cache, no-store, must-revalidate Pragma: no-cache Expires: 0"`

[https://www.zoomeye.org/searchResult?q=â€HTTP%2F1.0 200 OK Content-Type%3A text%2Fhtml%3B charset%3Dutf-8 Content-Length%3A 682 Cache-Control%3A no-cache%2C no-store%2C must-revalidate Pragma%3A no-cache Expires%3A 0â€](https://www.zoomeye.org/searchResult?q=%22HTTP%2F1.0%20200%20OK%20Content-Type%3A%20text%2Fhtml%3B%20charset%3Dutf-8%20Content-Length%3A%20682%20Cache-Control%3A%20no-cache%2C%20no-store%2C%20must-revalidate%20Pragma%3A%20no-cache%20Expires%3A%200%22)

[![](https://p5.ssl.qhimg.com/t01c8512b09a7079929.png)](https://p5.ssl.qhimg.com/t01c8512b09a7079929.png)



## 4ã€SpiderLabs Responder

è¿™ä¸ªç›®æ ‡åŒæ ·æ¥è‡ªäºFireEyeå…¬å¸çš„ç ”ç©¶è€…çš„PPTï¼Œå…³äºSpiderLabs Responderçš„ä»‹ç»å¯ä»¥è‡ªè¡Œæœç´¢æˆ–è€…è®¿é—®é¡¹ç›®ä¸»é¡µï¼š[https://github.com/SpiderLabs/Responder](https://github.com/SpiderLabs/Responder) è¿™ä¸ªæ¡†æ¶å­—çº¹æ˜¯ç”±äºhttpå¤´é‡Œç›´æ¥ç¡¬ç¼–ç äº†Date:å¤´[8]

```
class IIS_Basic_401_Ans(Packet):
fields = OrderedDict([
("Code", "HTTP/1.1 401 Unauthorized\r\n"),
("ServerType", "Server: Microsoft-IIS/6.0\r\n"),
("Date", "Date: Wed, 12 Sep 2012 13:06:55 GMT\r\n"),
("Type", "Content-Type: text/html\r\n"),
("WWW-Auth", "WWW-Authenticate: Basic realm=\"Authentication Required\"\r\n"),
("PoweredBy", "X-Powered-By: [ASP.NET](http://asp.net/)\r\n"),
("AllowOrigin", "Access-Control-Allow-Origin: *\r\n"),
("AllowCreds", "Access-Control-Allow-Credentials: true\r\n"),
("Len", "Content-Length: 0\r\n"),
("CRLF", "\r\n"),
])
```

[![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC)](https://p1.ssl.qhimg.com/t017b229e574d604cad.png)

ä»ä¸Šé¢çš„æ¡ˆä¾‹æˆ–è€…æ­£å¸¸æƒ…å†µæ¥çœ‹Dateæ˜¯å˜åŒ–çš„ï¼Œå¯ä»¥ç›´æ¥æœç´¢ï¼š

`"Date: Wed, 12 Sep 2012 13:06:55 GMT"`

[https://www.zoomeye.org/searchResult?q=â€Date%3A Wed%2C 12 Sep 2012 13%3A06%3A55 GMTâ€](https://www.zoomeye.org/searchResult?q=%22Date%3A%20Wed%2C%2012%20Sep%202012%2013%3A06%3A55%20GMT%22)

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨FireEyeé‚£ä¸ªPPTé‡Œå¼ºè°ƒäº†â€HTTP/1.1 401 Unauthorizedâ€,ä¸è¿‡åœ¨æˆ‘çœ‹æ¥è¿™ä¸ªæ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œåœ¨æˆ‘çœ‹æ¥è¿™ä¸ªDate:ç¡¬ç¼–ç èƒ½æ’ä¸Šçš„å‡ ç‡é‚£æ˜¯éå¸¸å°çš„ï¼ŒSpiderLabs Respondeæ˜¯ä¸ªå¼€æºé¡¹ç›®ï¼Œå¾ˆå¯èƒ½æœ‰å…¶ä»–å˜ç§æˆ–è€…å‚è€ƒä»£ç çš„é¡¹ç›®ï¼Œäºæ˜¯æˆ‘åœ¨githubä¸Šæœç´¢äº†ä¸‹ç¡®å®æ‰¾åˆ°ä¸å°‘ï¼š[https://github.com/search?q=â€Date%3A+Wed%2C+12+Sep+2012+13%3A06%3A55+GMTâ€&amp;type=Code](https://github.com/search?q=%22Date%3A+Wed%2C+12+Sep+2012+13%3A06%3A55+GMT%22&amp;type=Code) å¤§éƒ¨åˆ†å±äºä»£ç†ä¸­é—´äººæ¡†æ¶ã€‚

[![](https://p2.ssl.qhimg.com/t0194fab7b2fbe490b7.png)](https://p2.ssl.qhimg.com/t0194fab7b2fbe490b7.png)



## 5ã€PoshC2

PoshC2 æ˜¯åŸºäºpowershellå¼€å‘çš„C2ä»£ç†æ¡†æ¶ï¼Œä»‹ç»è¯¦è§ï¼š[https://github.com/nettitude/PoshC2](https://github.com/nettitude/PoshC2) æˆ‘ä»¬è¿™é‡Œä»å¦å¤–ä¸€ä¸ªä½¿ç”¨ç½‘ç»œç©ºé—´æœç´¢å¼•æ“çš„å¸¸ç”¨å¥—è·¯ï¼šâ€œè¯ä¹¦æœç´¢â€ï¼Œåœ¨githubé¡¹ç›®ä¸»é¡µæœç´¢Certificate åæ‰¾åˆ° [https://github.com/nettitude/PoshC2/blob/9d76be26e4c606c3630d0a54fb0d36566e696526/poshc2/server/Config.py](https://github.com/nettitude/PoshC2/blob/9d76be26e4c606c3630d0a54fb0d36566e696526/poshc2/server/Config.py) ä»£ç ï¼š

```
Certificate Options

Cert_C = "US"
Cert_ST = "Minnesota"
Cert_L = "Minnetonka"
Cert_O = "Pajfds"
Cert_OU = "Jethpro"
Cert_CN = "P18055077"
Cert_SerialNumber = 1000
Cert_NotBefore = 0
Cert_NotAfter = (10 * 365 * 24 * 60 * 60)
```

çœ‹åˆ°â€P18055077â€è¿™ä¸ªå¾ˆç‰¹åˆ«ï¼Œç›´æ¥ä½¿ç”¨ZoomEyeè¯ä¹¦æœç´¢è¯­æ³•ï¼š

`ssl:"P18055077"`

[https://www.zoomeye.org/searchResult?q=ssl:â€P18055077â€](https://www.zoomeye.org/searchResult?q=ssl:%22P18055077%22)

[![](https://p5.ssl.qhimg.com/t01e815f0368f75b428.png)](https://p5.ssl.qhimg.com/t01e815f0368f75b428.png)

è¿™é‡Œé¡ºå¸¦æä¸€å¥ï¼šè¯ä¹¦æœç´¢å¾ˆå¯èƒ½å‡ºç°è¦†ç›–ä¸å…¨çš„æƒ…å†µï¼Œè¿™ä¸ªä¾‹å­é‡Œæœ¬èº«æœç´¢å‡ºæ¥çš„ç»“æœä¸å¤ªå¤šæ‰€ä»¥ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œæ‰€ä»¥é‡åˆ°å…¶ä»–çš„ä¾‹å­å¯ä»¥å…ˆé€šè¿‡è¯ä¹¦æœç´¢çš„åˆ°è¿”å›çš„banneråï¼Œå†æ ¹æ®æå–bannerç‰¹å¾å»æœç´¢åŒ¹é…ã€‚



## æ€»ç»“

1ã€ä¸»åŠ¨æ‰«ææ¢æµ‹åŠç½‘ç»œç©ºé—´æœç´¢å¼•æ“å¯ä»¥ååŠ©æˆ‘ä»¬è¿½è¸ªè¯†åˆ«å„ç§æ”»å‡»è€…ç—•è¿¹ï¼Œä¹Ÿéå¸¸è®¤åŒé»‘å“¥æå‡ºæ¥çš„â€œåŠ¨æ€æµ‹ç»˜â€çš„è§‚ç‚¹ï¼Œé€šè¿‡åŠ¨æ€æµ‹ç»˜å…³è”å„ç§æ•°æ®å¯ä»¥æ›´åŠ å®Œå–„æ”»å‡»è€…ç”»åƒï¼Œæ¯”å¦‚ä¸Šæ–‡é‡Œä»‹ç»çš„å‡ ä¸ªæ¡†æ¶éƒ½æ˜¯å†å²ä¸Šå¤šä¸ªAPTç»„ç»‡ä½¿ç”¨è¿‡çš„æ¡†æ¶ã€‚ç›®å‰ä»ç«çœ¼ç­‰å¤šä¸ªå…¬å¸çš„æ–‡ç« æ¥çœ‹ï¼Œæœ‰è·Ÿå¤šçš„å®‰å…¨å…³æ³¨åˆ°ä¸»åŠ¨æ‰«æåŠç½‘ç»œç©ºé—´æœç´¢å¼•æ“åœ¨APTè¿½è¸ªé¢†åŸŸçš„åº”ç”¨ã€‚

2ã€å¯¹äºçº¢é˜Ÿæ¥è¯´åº”è¯¥æ³¨æ„åˆ°C2æœåŠ¡å™¨çš„å®‰å…¨ï¼Œå°¤å…¶è¿™äº›æ¸—é€æ”»å‡»æ¡†æ¶çš„é»˜è®¤é…ç½®éœ€è¦åšä¿®æ”¹ï¼Œä»¥å…è¢«ä¸»åŠ¨æ‰«æè¿½è¸ªã€‚

3ã€å¯¹äºè“é˜Ÿæ¥è¯´ç½‘ç»œç©ºé—´æœç´¢å¼•æ“ä¹Ÿæ˜¯å¨èƒæƒ…æŠ¥çš„æ¥æºä¹‹ä¸€ï¼Œæˆ‘ä»¬èƒ½æå‰è·å–æŸäº›C2 IPå¹¶ç›‘æ§æ‹‰é»‘ï¼Œæˆ–è®¸æœ‰æ„æƒ³ä¸åˆ°çš„å‘ç°ã€‚

å‚è€ƒï¼š

[1] [Identifying Cobalt Strike team servers in the wild by using ZoomEye](https://medium.com/@80vul/identifying-cobalt-strike-team-servers-in-the-wild-by-using-zoomeye-debf995b6798)

[2] [Identifying Cobalt Strike team servers in the wild by using ZoomEye(Part 2)](https://medium.com/@80vul/identifying-cobalt-strike-team-servers-in-the-wild-by-using-zoomeye-part-2-acace5cc612c)

[3] [Identifying Cobalt Strike team servers in the wild](https://blog.fox-it.com/2019/02/26/identifying-cobalt-strike-team-servers-in-the-wild/)

[4] [Analysing meterpreter payload with Ghidra](https://isc.sans.edu/forums/diary/Analysing+meterpreter+payload+with+Ghidra/24722/)

[5] [https://github.com/rapid7/metasploit-framework/blob/76954957c740525cff2db5a60bcf936b4ee06c42/lib/msf/core/handler/reverse_http.rb#L82](https://github.com/rapid7/metasploit-framework/blob/76954957c740525cff2db5a60bcf936b4ee06c42/lib/msf/core/handler/reverse_http.rb#L82)

[6] [https://censys.io/ipv4?q=8f3ff2e2482468f3b9315a433b383f0cc0f9eb525889a34d4703b7681330a3fb](https://censys.io/ipv4?q=8f3ff2e2482468f3b9315a433b383f0cc0f9eb525889a34d4703b7681330a3fb)

[7] [https://github.com/aaronst/talks/blob/master/scanttouchthis.pdf](https://github.com/aaronst/talks/blob/master/scanttouchthis.pdf)

[8] [https://github.com/SpiderLabs/Responder/blob/master/packets.py](https://github.com/SpiderLabs/Responder/blob/master/packets.py)
