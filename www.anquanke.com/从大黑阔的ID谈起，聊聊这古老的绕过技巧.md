> åŸæ–‡é“¾æ¥: https://www.anquanke.com//post/id/211363 


# ä»å¤§é»‘é˜”çš„IDè°ˆèµ·ï¼ŒèŠèŠè¿™å¤è€çš„ç»•è¿‡æŠ€å·§


                                é˜…è¯»é‡ Â Â 
                                **271033**
                            
                        |
                        
                                                            è¯„è®º
                                <b>
                                    <a target="_blank">5</a>
                                </b>
                                                                                                                                    ![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC)
                                                                                            



[![](https://p4.ssl.qhimg.com/t010ed033754304978e.png)](https://p4.ssl.qhimg.com/t010ed033754304978e.png)



æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨å®‰å…¨åœˆå­é‡Œæ··çš„åŸºæœ¬éƒ½æœ‰ä¸€ä¸ªid,è€Œä¸”è¿™ä¸ªidè¿˜å¾ˆæœ‰ç‰¹è‰²ï¼Œæœ‰ç‰¹è‰²åˆ°ä¸€çœ‹åˆ°ä»–çš„idä½ å°±çŸ¥é“è¿™ä¸ªäººæ˜¯æå®‰å…¨çš„ï¼Œä¾‹å¦‚ï¼šr00t,jas502n,passw0rdâ€¦

è€Œå½“æˆ‘äº®å‡ºæˆ‘çš„id,æ‰€æœ‰çœ‹æ–‡ç« çš„äººéƒ½ç¬‘ï¼Œæœ‰çš„å«åˆ°ï¼Œâ€é˜¿ä¿¡ï¼Œä½ çš„idçœŸä¸ä¸“ä¸šâ€œï¼æˆ‘ä¸å›ç­”ï¼Œå¯¹ç€ç”µè„‘ï¼Œç»§ç»­çœ‹æˆ‘çš„å–œç¾Šç¾Šä¸ç°å¤ªç‹¼ã€‚ä»–ä»¬åˆæ•…æ„é«˜å£°åš·é“ï¼Œâ€ä½ ä¸€å®šæ˜¯ä¸ªğŸŒ¶ğŸ”â€œ

æˆ‘çå¤§ğŸ‘€ï¼Œâ€ä½ æ€ä¹ˆè¿™æ ·å‡­ç©ºæ±¡äººæ¸…ç™½â€¦â€¦â€ï¼Œâ€œä»€ä¹ˆæ¸…ç™½ï¼Ÿæˆ‘å‰å¤©äº²çœ¼çœ‹ä½ æ°´äº†ä¸€ç¯‡æ–‡ç« â€æˆ‘ä¾¿æ¶¨çº¢äº†è„¸ï¼Œé¢ä¸Šçš„é’ç­‹æ¡æ¡ç»½å‡ºï¼Œäº‰è¾©é“ï¼Œâ€œå†™æ°´æ–‡ä¸èƒ½ç®—åƒåœ¾â€¦â€¦æ°´æ–‡ï¼â€¦â€¦æå®‰å…¨çš„äº‹ï¼Œèƒ½ç®—åƒåœ¾ä¹ˆï¼Ÿâ€æ¥è¿ä¾¿æ˜¯éš¾æ‡‚çš„è¯ï¼Œä»€ä¹ˆâ€œå›å­å›ºèœâ€ï¼Œä»€ä¹ˆâ€œè€…ä¹â€ä¹‹ç±»ï¼Œå¼•å¾—ä¼—äººéƒ½å“„ç¬‘èµ·æ¥ï¼šå±å¹•å¤–å……æ»¡äº†å¿«æ´»çš„ç©ºæ°”ã€‚

> ä¸€ä¸å°å¿ƒæ²¡æ”¶ä½ï¼Œåˆå†™äº†ä¸ªæ®µå­(ä¸ä¼šçœŸæœ‰äººä¸çŸ¥é“è¿™æ˜¯å­”ä¹™å·±ç‰‡æ®µå§ï¼Œä¸ä¼šå§ï¼Œä¸ä¼šå§)

å¤§é»‘é˜”ä»¬ç”¨çš„idéƒ½ä¼šç”¨ä¸€äº›**å½¢ä¼¼è€Œæ„é**çš„å­—ç¬¦ä»£æ›¿åŸå­—ç¬¦ï¼Œè™½ç„¶å­—ç¬¦å¥‡å¥‡æ€ªæ€ªï¼Œä½†æ˜¯æˆ‘ä»¬ä¾ç„¶èƒ½å¤Ÿè¯»æ‡‚è¿™äº›idä»£è¡¨çš„ä»€ä¹ˆæ„æ€

æˆ‘ä»¬ä¸ºä»€ä¹ˆèƒ½å¤Ÿè¯»æ‡‚è¿™äº›idçš„æ„æ€ï¼Ÿ

å› ä¸ºæˆ‘ä»¬å¤§è„‘é‡Œæœ‰ä¸€å¥—ç³»ç»Ÿ,å¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠè¿™äº›ç‰¹æ®Šçš„å­—ç¬¦è½¬æ¢ä¸ºæ­£å¸¸å­—ç¬¦ï¼Œæˆ‘ä»¬ä¼šæŠŠr00tè¿˜åŸä¸ºroot

è€Œè¿™ï¼Œä¹Ÿæ­£æ˜¯æˆ‘ä»Šå¤©è¦è¯´çš„ä¸€ç§ç»•è¿‡å„ç§é™åˆ¶çš„æŠ€å·§â€”â€”Unicodeè§„èŒƒåŒ–Bypass



## åˆè¯†Unicode

åœ¨è°ˆç»•è¿‡æ–¹å¼ä¹‹å‰ï¼Œè¿˜æ˜¯å…ˆæ¥çœ‹ä¸€ä¸‹Unicodeçš„ç›¸å…³çŸ¥è¯†å§ï¼Œæ¯•ç«Ÿå¾ˆå¤šäººéƒ½ä¸æ¸…æ¥šUnicodeã€utf-8ã€gbkã€utf-16ã€asciiçš„å…³ç³»ï¼Œä¸æ¸…æ¥šä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä¹Ÿä¸ä¼šè®²çš„ğŸ˜ï¼Œæˆ‘ä»¬å°±çœ‹å‡ ä¸ªå¤§çš„æ¦‚å¿µå°±è¡Œ
1. 1.æ²¡æœ‰Unicodeä¹‹å‰ï¼Œä¸åŒå›½å®¶åœ°åŒºä¸ºäº†è¡¨ç¤ºè‡ªå·±å›½å®¶çš„æ–‡å­—ï¼Œå®ç°äº†ä¸åŒçš„ç¼–ç æ–¹æ¡ˆï¼Œè¿™äº›ä¸åŒçš„ç¼–ç æ–¹æ¡ˆäº’ä¸å…¼å®¹ã€‚åæ¥ï¼Œå¤§å®¶å‘ç°è¿™ç§æ–¹å¼å¾ˆéš¾å—ï¼Œäºæ˜¯æœ‰äº†Unicodeï¼Œè¿™å¥—æ ‡å‡†ç»™ä¸–ç•Œä¸Šæ¯ä¸ªå­—ç¬¦éƒ½å®‰æ’äº†ä¸€ä¸ªå”¯ä¸€çš„ç¼–ç ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªç¼–ç å«åš**ç ç‚¹**ã€‚
1. 2.è®°ä½ï¼ŒUnicodeåªæ˜¯åˆ¶å®šäº†è¿™ä¹ˆä¸€ç§å­—ç¬¦åˆ°ç ç‚¹çš„æ˜ å°„å…³ç³»
1. 3.ç¼–ç ï¼šè™½ç„¶æœ‰äº†ç ç‚¹ï¼Œä½†æ˜¯ä¸ºäº†åœ¨è®¡ç®—æœºä¸Šå­˜å‚¨æˆ–è€…ç½‘ç»œä¼ è¾“ï¼Œè¿˜éœ€è¦å¯¹è¿™äº›å­—ç¬¦è¿›è¡Œç¼–ç ï¼Œå¸¸è§çš„ç¼–ç æ–¹å¼å°±æ˜¯utf-8
é‚£è¿™ä¸ªæ—¶å€™å¯èƒ½æœ‰äººå°±ä¼šç–‘æƒ‘äº†ï¼Œä¸ºå•¥ä¸ç›´æ¥å­˜å‚¨æŒ‰ç…§ç ç‚¹å­˜å‚¨å‘¢ï¼Ÿ

å› ä¸ºæ— æ³•è¯†åˆ«ï¼Œä½ æƒ³å‘€ï¼Œæœ‰äº›å­—ç¬¦ç ç‚¹éœ€è¦ä¸€ä¸ªå­—èŠ‚å­˜å‚¨ï¼Œè€Œæœ‰äº›å­—ç¬¦ç ç‚¹å¾ˆå¤§ï¼Œå¯èƒ½å ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œå½“ä½ æŠŠæ•°æ®å­˜å‚¨åˆ°è®¡ç®—æœºä¸­æ—¶ï¼Œè®¡ç®—æœºæ€ä¹ˆçŸ¥é“ä½ å­˜å‚¨çš„è¿™ä¸ªä¸œè¥¿åˆ°åº•æ˜¯æŒ‰ç…§ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—ç¬¦è¯†åˆ«ï¼Œè¿˜æ˜¯ä¸¤ä¸ªå­—èŠ‚ä¸€ä¸ªå­—ç¬¦è¯†åˆ«ï¼Ÿè¿™å°±éœ€è¦ç¼–ç æ¥è§£å†³ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æ‹“å±•é˜…è¯»ä¸€ä¸‹ï¼Œæˆ‘è¿™é‡Œå°±ä¸å±•å¼€äº†
- 4.å½“ç³»ç»Ÿå¤„ç†æ•°æ®æ—¶ï¼Œå®ƒéœ€è¦çŸ¥é“ç”¨äºå°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦çš„ç¼–ç æ–¹å¼ã€‚
- 5.utf-8æ˜¯æœ€å¸¸è§çš„ç¼–ç æ–¹å¼ï¼Œä½†æ˜¯è¿˜æœ‰å…¶ä»–ç¼–ç ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„utf-16ã€utf-32ç­‰ç­‰
é‚£ä»€ä¹ˆæ˜¯Unicodeè§„èŒƒåŒ–å‘¢ï¼Ÿ

é€šä¿—ç‚¹è¯´å°±æ˜¯Unicodeè§„èŒƒåŒ–ä¼šæŠŠæœ¬åœ°ç¼–ç ç³»ç»Ÿä¸­æ²¡æœ‰çš„ç‰¹æ®Šå­—ç¬¦è§„èŒƒä¸ºä¸€ä¸ªæœ¬åœ°ç¼–ç ç³»ç»Ÿä¸­å­˜åœ¨çš„ï¼Œä¸è¿™ä¸ªç‰¹æ®Šå­—ç¬¦å½¢çŠ¶å¾ˆç›¸ä¼¼çš„å­—ç¬¦ï¼Œä¾‹å¦‚`Ã `ä¼šè¢«è§„èŒƒä¸º`a`ã€‚

é‚£æ€ä¹ˆåˆ©ç”¨ä»–æ¥ç»•è¿‡WAFå‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªå¤è€çš„ç»•è¿‡åœºæ™¯



## mssqlä¸­çš„Unicodeè§„èŒƒåŒ–

ä¼—æ‰€å‘¨çŸ¥ï¼Œé˜²æ­¢SQLæ³¨å…¥çš„æœ€ä½³æ–¹æ³•æ˜¯åœ¨å­˜å‚¨è¿‡ç¨‹æˆ–å‚æ•°åŒ–æŸ¥è¯¢ä¸­ä½¿ç”¨å‚æ•°ã€‚ä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°æŠŠå•å¼•å·æ›¿æ¢ä¸ºä¸¤ä¸ªå•å¼•å·çš„é˜²å¾¡æªæ–½ã€‚çš„ç¡®æŒºæ¶å¿ƒçš„ï¼Œä½†è¿™ç§é˜²å¾¡æ–¹å¼å°±ä¸‡äº‹å¤§å‰äº†å—ï¼Ÿ

æˆ‘æœ€è¿‘åœ¨é€›è®ºå›çš„æ—¶å€™æ‰äº†è§£åˆ°è¿™ç§ç»•è¿‡æ‰‹æ³•ï¼Œè€å¤–ä»¬æŠŠè¿™ç§ç»•è¿‡æ–¹å¼ç§°ä¸ºâ€œUnicode Smugglingâ€,æœ€æ—©æ˜¯åœ¨2007å¹´å¹¿æ³›ä¸ºäººæ‰€çŸ¥ï¼Œè¯è¯´é‚£ä¸ªæ—¶å€™æˆ‘è¿˜åœ¨è¯»å°å­¦å§ğŸ¤£

> æ¼”è®²PPTï¼š[https://owasp.org/www-pdf-archive/OWASP_IL_2007_SQL_Smuggling.pdf](https://owasp.org/www-pdf-archive/OWASP_IL_2007_SQL_Smuggling.pdf)

è¿™ä¸ªæ‰‹æ³•å½’ç»“ä¸ºä¸€å¥è¯å°±æ˜¯ï¼š

åœ¨SQLè¯­å¥åŠ¨æ€æ‹¼æ¥çš„æƒ…å†µä¸‹ï¼Œå¦‚æœé˜²å¾¡æ˜¯åœ¨æ•°æ®åº“ä¸­å®ç°çš„ï¼ˆç±»ä¼¼ä¸Šé¢æåˆ°çš„é‚£ç§æŠŠå•ä¸ªå¼•å·æ›¿æ¢ä¸ºä¸¤ä¸ªå¼•å·çš„é˜²å¾¡ï¼‰ï¼Œå¹¶ä¸”SQLè¯­å¥æ˜¯ä»¥varcharç­‰éUnicodeå­—ç¬¦ä¸²å­˜å‚¨çš„ï¼Œè¿™æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬çš„è¾“å…¥æ˜¯ä¸€ä¸ªUnicodeå­—ç¬¦ï¼Œé‚£ä¹ˆæ•°æ®åº“å°±ä¼šè‡ªåŠ¨æŠŠæˆ‘ä»¬çš„Unicodeå­—ç¬¦è½¬æ¢ä¸ºä¸€ä¸ªä¸å®ƒå½¢çŠ¶ç‰¹åˆ«ç›¸ä¼¼çš„æœ¬åœ°å­—ç¬¦

ä¾‹å¦‚æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªUnicodeçš„å•å¼•å·ï¼Œå°±ä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ªASCIIçš„å•å¼•å·

å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ç»•è¿‡å¾ˆå¤šé˜²å¾¡æœºåˆ¶ï¼Œç›´æ£é»„é¾™

æ–‡å­—æè¿°å¯èƒ½ä¸å¤ªæ¸…æ™°ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªSQLserverä¸‹çš„ä¾‹å­ï¼š

```
create proc updatetable
@newname nvarchar(100)
as
set @newname = replace(@newname, '''', '''''') /*å•å¼•å·åœ¨SQLserverä¸­æ˜¯è½¬ä¹‰ç¬¦*/

declare @updatestat varchar(MAX)
set @updatestat = 'update mytable set name=''' + @newname + ''''
exec(@updatestat)
```

ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„SQLè¯­å¥æ˜¯é€šè¿‡åŠ¨æ€æ‹¼æ¥çš„æ–¹å¼ï¼Œå¹¶ä¸”å­˜å‚¨ä¸ºvarcharæ•°æ®ç±»å‹,ä½†æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å˜é‡[@newname](https://github.com/newname)å´æ˜¯nvarcharç±»å‹ï¼Œè¿™ä¸ªç±»å‹å°±æ˜¯Unicodeå­—ç¬¦ä¸²ç±»å‹

[![](https://p0.ssl.qhimg.com/t010c24a456f032e8c3.png)](https://p0.ssl.qhimg.com/t010c24a456f032e8c3.png)

ä½†æ˜¯ä¸å¹¸çš„æ˜¯è¿™ç§åœºæ™¯å‡ ä¹å·²ç»ç»è¿¹äº†ï¼Œæ¯•ç«Ÿå¤ªè€äº†ï¼Œæˆ‘åœ¨ä½¿ç”¨sqlserverä¸mysqlå¤ç°çš„æ—¶å€™éƒ½æ²¡æœ‰æˆåŠŸï¼Œæœ¬æƒ³ç”¨è€ç‰ˆsqlserverå†è¯•ä¸€ä¸‹ï¼Œä½†æ˜¯ï¼Œsqlserverè£…ç¬¬ä¸€æ¬¡ç®€å•ï¼Œå¸è½½å´è€æ˜¯å¸è½½ä¸å¹²å‡€â€¦äºæ˜¯ï¼Œæˆ‘å°±æ”¾å¼ƒäº†ğŸ˜‘

é‚£ä¹ˆï¼Œæ˜¯ä¸æ˜¯è¯´è¿™ç§æ‰‹æ³•å°±æ²¡ç”¨äº†å‘¢ï¼Ÿ

sqlserverä¸å†éšå¼è½¬æ¢ï¼Œä½†æ˜¯è¿™ä¸ªæ€è·¯è¿˜æ˜¯å€¼å¾—å­¦ä¹ çš„å˜›ï¼Œæˆ‘ä»¬ç¨å¾®æ‹“å±•ä¸€ä¸‹



## éšœçœ¼æ³•

[![](https://p5.ssl.qhimg.com/t01da596a3487a141b1.png)](https://p5.ssl.qhimg.com/t01da596a3487a141b1.png)

[![](https://p1.ssl.qhimg.com/t014833eb7fa809ef87.png)](https://p1.ssl.qhimg.com/t014833eb7fa809ef87.png)

å¦‚æœä½ æ˜¯ç”¨çš„Chromeï¼ŒChromeæ˜¯ä¼šæç¤ºä½ çš„ï¼ˆChromeğŸ‚ğŸºï¼ï¼ï¼ï¼‰ï¼Œå¹¶ä¸”æ˜¾ç¤ºè¿™æ ·ä¸€ä¸ªåŸŸåï¼š`https://www.xn--80ak6aa92e.com/`

é‚£ä¹ˆè¿™ä¸ªåŸŸååˆ°åº•æ˜¯ä»€ä¹ˆç©æ„?ä¸ºå•¥åœ¨Firefoxä¸Šæ˜¾ç¤ºçš„æ˜¯è‹¹æœå®˜ç½‘çš„åœ°å€ï¼Œåœ¨Chromeä¸‹å´æ˜¯å¥‡æ€ªçš„åœ°å€ï¼Ÿ

è¿™å¾—å¤šäºäº†å›½é™…åŒ–åŸŸåçš„è®¾è®¡ï¼ˆIDN),å›½é™…åŒ–åŸŸåå…è®¸é™¤asciiå­—ç¬¦ä»¥å¤–çš„å…¶ä»–å­—ç¬¦å­˜åœ¨ï¼Œè€Œæˆ‘ä»¬å‰é¢ä¹Ÿæåˆ°äº†åŒå½¢å­—ç¬¦çš„å­˜åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°Unicodeä¸­ä¸appleè¿™å‡ ä¸ªå­—ç¬¦å¾ˆåƒçš„å­—ç¬¦å°±è¡Œäº†

é‚£æœ‰äººå¯èƒ½åˆè¦é—®äº†ï¼šé˜¿ä¿¡å•Šï¼Œé‚£ä¸ºä»€ä¹ˆChromeä¸‹æ˜¾ç¤ºçš„åŸŸåæ˜¯`xn--80ak6aa92e`å‘¢ï¼Ÿ

è¿™ä¸ªä¸œè¥¿å…¶å®æ˜¯Punnycode,å®ƒå¯ä»¥æŠŠç‰¹æ®Šå­—ç¬¦çš„åŸŸåè½¬æ¢ä¸ºè¿™ç§asciiå­—ç¬¦è¡¨ç¤ºçš„åŸŸåï¼Œä¾‹å¦‚â€xnâ€“s7y.coâ€ ä»£è¡¨ç€â€çŸ­.coâ€ï¼Œä¹Ÿæ­£æ˜¯punnycodeçš„å­˜åœ¨ï¼Œå›½é™…åŸŸåæ‰èƒ½å¤Ÿæˆä¸ºç°å®ã€‚

> Punnycodeè½¬æ¢å·¥å…·åœ°å€ï¼š[https://www.punycoder.com/](https://www.punycoder.com/)

å½“ç„¶ï¼Œå¦‚æœä½ è§‰å¾—ä¸Šè¿°æ‰‹æ³•å¤ªéº»çƒ¦äº†ï¼Œè€Œä¸”ä¸é€‚ç”¨äºchrome,ä½ è¿˜å¯ä»¥é‡‡å–è¿™ç§æ–¹å¼ï¼Œæ¯”å¦‚æ¨ç‰¹å®˜ç½‘ï¼š`twiiter.com`

æœ‰æ²¡æœ‰ç¬¬ä¸€çœ¼è§‰å¾—æ²¡é—®é¢˜çš„åŒå­¦ï¼Œä¸¾ä¸ªæ‰‹ï¼

å†æ¯”å¦‚ç™¾åº¦ï¼š`ba1du.com`,è¯è¯´è¿™ç§éšœçœ¼æ³•ï¼Œæˆ‘ç¬¬ä¸€æ¬¡çŸ¥é“è¿˜æ˜¯åœ¨ã€Šç™½å¸½å­è®²æµè§ˆå™¨å®‰å…¨ã€‹è¿™æœ¬ä¹¦é‡Œï¼ˆå¥½åƒæ˜¯å§~ï¼‰



## æ²¡æœ‰å…¶ä»–ç©æ³•äº†å—ï¼Ÿ

é‚£æœ‰äººåˆè¦è¯´äº†ï¼šé˜¿ä¿¡å•Šï¼Œè¯´äº†åŠå¤©å°±æ˜¯ç”¨æ¥é’“é±¼å•Šï¼Ÿå°±è¿™ï¼Ÿå°±è¿™ï¼Ÿ

[![](https://p2.ssl.qhimg.com/t013536291842aa951e.png)](https://p2.ssl.qhimg.com/t013536291842aa951e.png)

ç¡®å®ï¼Œé’“é±¼è¿˜æ˜¯æœ‰ç‚¹é¸¡è‚‹äº†ï¼ŒæŒ–æ´èƒ½ç”¨åˆ°å—ï¼Ÿ

èƒ½ï¼Œè€Œä¸”å¤§æœ‰å¯ä¸ºï¼

æˆ‘ä»¬å¹¼å„¿å›­çš„æ—¶å€™å°±çŸ¥é“ï¼Œé€šå¸¸çš„Unicodeè§„èŒƒåŒ–ä¸€èˆ¬æœ‰å››ç§å½¢å¼ï¼š
- NFC: Normalization Form Canonicalï¼ˆè§„èŒƒï¼‰ Composition
- NFD: Normalization Form Canonical Decomposition
- NFKC: Normalization Form Compatibilityï¼ˆå…¼å®¹ï¼‰ Composition
- NFKD: Normalization Form Compatibility Decomposition
ä¸€å¼ è¡¨çœ‹æ‡‚ä»–ä»¬çš„å¤§è‡´åŒºåˆ«ï¼š

[![](https://p0.ssl.qhimg.com/t01b8d212cfa7fd3d8f.png)](https://p0.ssl.qhimg.com/t01b8d212cfa7fd3d8f.png)

å¯ä»¥çœ‹åˆ°ï¼ŒNFKCä¸NFKDæ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ï¼Œæœ‰æ„æ€å°±æœ‰æ„æ€åœ¨ã€å…¼å®¹ã€‘ä¸Šï¼Œè¿™è¯´æ˜æ“ä½œç©ºé—´å¾ˆå¤§ã€‚

æˆ‘ä»¬ä»¥Python3ä¸ºä¾‹ï¼Œæ¼”ç¤ºä¸‹è¿™å‡ ç§Unicodeè§„èŒƒåŒ–çš„ç‰¹ç‚¹ï¼š

[![](https://p2.ssl.qhimg.com/t01966480dd554628d1.png)](https://p2.ssl.qhimg.com/t01966480dd554628d1.png)

ç»“æœå¦‚ä¸‹ï¼š

[![](https://p4.ssl.qhimg.com/t011c7d1e6588392f07.png)](https://p4.ssl.qhimg.com/t011c7d1e6588392f07.png)

å¯ä»¥çœ‹åˆ°NFKCä¸NFKDè§„èŒƒåŒ–ï¼ŒæŠŠæˆ‘ä»¬çš„è¾“å…¥è§„èŒƒæˆäº†æˆ‘ä»¬ç†Ÿæ‚‰çš„asciiå­—ç¬¦ï¼Œè¿™å°±å¾ˆniceäº†ï¼

ä¸ºäº†æ›´å¥½çš„æ¼”ç¤ºè¿™ç§ä¸æ­£ç¡®åœ°ä½¿ç”¨è§„èŒƒåŒ–å¸¦æ¥çš„å®‰å…¨é—®é¢˜ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå°demo:

åˆ›å»ºä¸€ä¸ªflaskæœåŠ¡ï¼š

```
from flask import Flask, abort, request
import unicodedata
from waf import waf

app = Flask(__name__)


@app.route('/')
def Welcome_name():
  name = request.args.get('name')


  if waf(name):
    abort(403, description="XSS!!!")
  else:
    name = unicodedata.normalize('NFKD', name) #NFC, NFKC, NFD, and NFKD
    return 'Results: ' + name

if __name__ == '__main__':
  app.run(port=5000)
```

ç„¶åç¼–å†™ä¸€ä¸ªç®€å•çš„wafï¼š

```
def waf(input):
    print(input)
    blacklist = ["~","!","@","#","$","%","^","&amp;","*","(",")","_","_","+","=","`{`","`}`","]","[","|","\",",".","/","?",";",":",""",""","&lt;","&gt;"]
    vuln_detected = False
    if any(string in input for string in blacklist): 
        vuln_detected = True
    return vuln_detected
```

å½“æˆ‘ä»¬ç”¨æ™®é€šçš„payloadå»æµ‹è¯•ï¼Œä¼šè¢«wafæ‹¦æˆª:

[![](https://p4.ssl.qhimg.com/t014684a0a52795b3b3.png)](https://p4.ssl.qhimg.com/t014684a0a52795b3b3.png)

[![](https://p2.ssl.qhimg.com/t01f61e5f634bc3e091.png)](https://p2.ssl.qhimg.com/t01f61e5f634bc3e091.png)

[![](https://p1.ssl.qhimg.com/t01e4f37fe221a76e61.png)](https://p1.ssl.qhimg.com/t01e4f37fe221a76e61.png)

ç°åœ¨è¿™ç§åœºæ™¯æ˜¯ä¸æ˜¯å°±ä¸é‚£ä¹ˆé¸¡è‚‹äº†ï¼Ÿ

é‚£æœ‰äººåˆè¦é—®äº†ï¼šé˜¿ä¿¡å•Šï¼Œè¯´äº†è¿™ä¹ˆå¤šï¼Œè¿™ç§æ¼æ´è¦æ€ä¹ˆæŒ–å‘¢ï¼Ÿ

[![](https://p4.ssl.qhimg.com/t01b48f9922cb088e51.png)](https://p4.ssl.qhimg.com/t01b48f9922cb088e51.png)

å¯¹äºæ²¡æœ‰å›æ˜¾çš„ç‚¹ï¼Œå°±æ²¡åŠæ³•ç›´æ¥è§‚å¯Ÿåˆ°äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨åŒæ ·çš„æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼Œä¸‡ä¸€å‘¢ï¼Ÿ

å¯¹äº†ï¼Œåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæœ€å¥½æ˜¯å¯¹è¿™äº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œurlç¼–ç ï¼Œurlç¼–ç çš„å½¢å¼å¾ˆå¤šï¼Œä½†æ˜¯ä¸€èˆ¬æ˜¯å…ˆæŠŠè¿™äº›å­—ç¬¦æŒ‰ç…§utf-8ç¼–ç è¿‡åå†è¿›è¡Œurlç¼–ç ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨æµè§ˆå™¨çš„æ§åˆ¶å°è¿›è¡Œç¼–ç ï¼Œæ–¹ä¾¿å¿«æ·ï¼š

[![](https://p4.ssl.qhimg.com/t012c03797a82f56fda.png)](https://p4.ssl.qhimg.com/t012c03797a82f56fda.png)

åœ¨ç¡®å®šäº†å­˜åœ¨Unicodeè§„èŒƒåŒ–è¿‡åï¼Œæˆ‘ä»¬å°±éœ€è¦æ„é€ payloadè¿›ä¸€æ­¥æµ‹è¯•äº†ï¼Œè¿™ä¸ªæ—¶å€™æ€ä¹ˆæ‰¾æŸä¸ªå­—ç¬¦å¯¹åº”çš„åŒå½¢å­—ç¬¦å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å°±è¦ç¥­å‡ºæˆ‘çš„ç¥å™¨äº†ï¼š[https://www.compart.com/en/unicode/U+0061](https://www.compart.com/en/unicode/U+0061)

è¿™ä¸ªå·¥å…·å¯ä»¥æœç´¢æŸä¸ªå­—ç¬¦çš„åŒå½¢å­—ç¬¦ï¼Œç‰¹åˆ«å¼ºå¤§ï¼Œä¾‹å¦‚`(`,å¯ä»¥æ‰¾åˆ°è¿™ä¹ˆå¤šåŒå½¢å­—ç¬¦ï¼š

[![](https://p0.ssl.qhimg.com/t0109047596ef14db02.png)](https://p0.ssl.qhimg.com/t0109047596ef14db02.png)

æœ‰äº†è¿™ä¸ªï¼Œæˆ‘æƒ³ï¼Œæ„é€ ä¸€ä¸ªç‰¹æ®Šçš„payloadå°±ä¸æ˜¯ä»€ä¹ˆéš¾äº‹å„¿äº†å§

[![](https://p1.ssl.qhimg.com/t01a87c9dfd6c3a5129.png)](https://p1.ssl.qhimg.com/t01a87c9dfd6c3a5129.png)

æˆ–è€…ï¼Œä½ å¯ä»¥åˆ°è¿™ä¸ªè¡¨é‡Œå»æ‰¾ï¼š[https://appcheck-ng.com/wp-content/uploads/unicode_normalization.html](https://appcheck-ng.com/wp-content/uploads/unicode_normalization.html)

[![](https://p3.ssl.qhimg.com/t011ccd962bff9e592e.png)](https://p3.ssl.qhimg.com/t011ccd962bff9e592e.png)



## åˆ©ç”¨åœºæ™¯

é™¤äº†ä¸Šé¢æåˆ°çš„xss,Unicodeè¿˜å¯ä»¥ç”¨åœ¨ä»€ä¹ˆåœºæ™¯ä¸Šï¼Ÿé‚£å¯å°±è€å¤šäº†ï¼

Sqlæ³¨å…¥

<th style="text-align: center;">å­—ç¬¦</th><th style="text-align: center;">payload</th><th style="text-align: center;">è§„èŒƒåŒ–å</th>
|------
<td style="text-align: center;">ï¼‡(U+FF07)</td><td style="text-align: center;">ï¼‡ or ï¼‡1ï¼‡=ï¼‡1</td><td style="text-align: center;">â€™ or â€˜1â€™=â€™1</td>
<td style="text-align: center;">ï¼‚(U+FF02)</td><td style="text-align: center;">ï¼‚ or ï¼‚1ï¼‚=ï¼‚1</td><td style="text-align: center;">â€ or â€œ1â€=â€1</td>
<td style="text-align: center;">ï¹£ (U+FE63)</td><td style="text-align: center;">adminï¼‡ï¹£ï¹£</td><td style="text-align: center;">adminâ€™â€“</td>

è·¯å¾„ç©¿è¶Š

<th style="text-align: center;">å­—ç¬¦</th><th style="text-align: center;">payload</th><th style="text-align: center;">è§„èŒƒåŒ–å</th>
|------
<td style="text-align: center;">â€¥ (U+2025)</td><td style="text-align: center;">â€¥/â€¥/â€¥/etc/passwd</td><td style="text-align: center;">../../../etc/passwd</td>
<td style="text-align: center;">ï¸°(U+FE30)</td><td style="text-align: center;">ï¸°/ï¸°/ï¸°/etc/passwd</td><td style="text-align: center;">../../../etc/passwd</td>

ssrf

<th style="text-align: center;">å­—ç¬¦</th><th style="text-align: center;">payload</th><th style="text-align: center;">è§„èŒƒåŒ–å</th>
|------
<td style="text-align: center;">â“ª (U+24EA)</td><td style="text-align: center;">â‘ â‘¡â‘¦.â“ª.â“ª.â‘ </td><td style="text-align: center;">127.0.0.1</td>

æ–‡ä»¶ä¸Šä¼ 

<th style="text-align: center;">å­—ç¬¦</th><th style="text-align: center;">payload</th><th style="text-align: center;">è§„èŒƒåŒ–å</th>
|------
<td style="text-align: center;">ï½ (U+FF50)Ê° (U+02B0)</td><td style="text-align: center;">test.ï½Ê°ï½</td><td style="text-align: center;">test.php</td>

å¼€æ”¾å¼è·³è½¬

<th style="text-align: center;">å­—ç¬¦</th><th style="text-align: center;">payload</th><th style="text-align: center;">è§„èŒƒåŒ–å</th>
|------
<td style="text-align: center;">ã€‚(U+3002)</td><td style="text-align: center;">jlajaraã€‚gitlabã€‚io</td><td style="text-align: center;">jlajara.gitlab.io</td>
<td style="text-align: center;">ï¼(U+FF0F)</td><td style="text-align: center;">ï¼ï¼jlajara.gitlab.io</td><td style="text-align: center;">//jlajara.gitlab.io</td>

æ¨¡æ¿æ³¨å…¥

<th style="text-align: center;">å­—ç¬¦</th><th style="text-align: center;">payload</th><th style="text-align: center;">è§„èŒƒåŒ–å</th>
|------
<td style="text-align: center;">ï¹›(U+FE5B)</td><td style="text-align: center;">ï¹›ï¹›3+3ï¹œï¹œ</td><td style="text-align: center;">`{``{`3+3`}``}`</td>
<td style="text-align: center;">ï¼» (U+FF3B)</td><td style="text-align: center;">ï¼»ï¼»5+5ï¼½ï¼½</td><td style="text-align: center;">[[5+5]]</td>

å‘½ä»¤æ³¨å…¥

<th style="text-align: center;">å­—ç¬¦</th><th style="text-align: center;">payload</th><th style="text-align: center;">è§„èŒƒåŒ–å</th>
|------
<td style="text-align: center;">ï¼† (U+FF06)</td><td style="text-align: center;">ï¼†ï¼†whoami</td><td style="text-align: center;">&amp;&amp;whoami</td>
<td style="text-align: center;">ï½œ (U+FF5C)</td><td style="text-align: center;">ï½œï½œ whoami</td><td style="text-align: center;">\</td>|\|whoami

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å‘æ•£ä¸€ä¸‹æ€ç»´ï¼ŒæŠŠè¯¥æ‰‹æ³•è¿ç”¨åˆ°äºŒæ¬¡æ¼æ´ä¸­ï¼Œæ¯”å¦‚ï¼Œç¬¬ä¸€æ¬¡æ’å…¥æ•°æ®çš„æ—¶å€™æ²¡æœ‰è¿›è¡Œè§„èŒƒåŒ–ï¼Œä½†æ˜¯ä»æ•°æ®åº“å–æ•°æ®çš„æ—¶å€™è¿›è¡Œäº†è§„èŒƒï¼Œå¯¼è‡´æ¼æ´å‘ç”Ÿã€‚

åŒæ ·çš„ï¼Œè¿™ä¹Ÿä¼šé€ æˆä¸€äº›é€»è¾‘æ¼æ´ï¼Œæ¯”å¦‚ï¼Œæ³¨å†Œä¸€ä¸ªåä¸º`Âªdmin`çš„è´¦å·ï¼Œåœ¨æ³¨å†Œçš„æ—¶å€™æ²¡æœ‰è§„èŒƒåŒ–ï¼Œæ•°æ®åº“ä¸­æ²¡æœ‰è¿™ä¸ªè´¦å·ï¼ŒæˆåŠŸæ³¨å†Œï¼Œä½†æ˜¯åœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™è¿›è¡Œäº†è§„èŒƒåŒ–ï¼ŒæŠŠ`Âªdmin`è§„èŒƒä¸ºadminï¼Œè¿™å°±ä¼šå¯¼è‡´ç™»å½•åˆ°adminç”¨æˆ·çš„è´¦å·ä¸Šï¼Œæ˜¯ä¸æ˜¯æŒºåˆºæ¿€çš„ã€‚



## å…¶ä»–

ç¿»äº†å‡ åç¯‡è‹±æ–‡æ–‡çŒ®æ€»ç»“çš„ä¸€ç¯‡ï¼Œè¿˜æœ‰å¾ˆå¤šæœ‰æ„æ€çš„ç‚¹æ²¡æœ‰æ‹“å±•å¼€ï¼ŒåªæŒ‘äº†å…¶ä¸­æœ€æœ‰ç”¨çš„éƒ¨åˆ†ï¼Œå¸Œæœ›ç»™å¤§å®¶æä¾›ä¸€äº›æ€è·¯ï¼Œæœ€åï¼Œæˆ‘èƒ½è¦ä¸€ä¸ªç‚¹èµå—ï¼Ÿåˆ«ã€ä¸‹æ¬¡ä¸€å®šã€‘äº†

ç‚¹èµåˆ°ä½ï¼Œå’±ä»¬ä¸‹ä¸€æœŸçœ‹ä¸€ä¸ªçœŸå®æ¡ˆä¾‹ï¼Œå—¨åˆ°ä¸è¡Œï¼ŒğŸ»å¼Ÿä»¬ï¼

å†æ”¾ä¸€ä¸ªå‚è€ƒPPTï¼š[https://www.blackhat.com/presentations/bh-usa-09/WEBER/BHUSA09-Weber-UnicodeSecurityPreview-SLIDES.pdf](https://www.blackhat.com/presentations/bh-usa-09/WEBER/BHUSA09-Weber-UnicodeSecurityPreview-SLIDES.pdf)
